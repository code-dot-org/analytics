{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.5", "generated_at": "2024-01-21T22:02:07.988169Z", "invocation_id": "b716930a-b32b-4105-a69c-3baccdb03a1f", "env": {"DBT_CLOUD_PROJECT_ID": "286339", "DBT_CLOUD_RUN_ID": "243232111", "DBT_CLOUD_JOB_ID": "412302", "DBT_CLOUD_RUN_REASON": "Kicked off from UI by jordan.springer@code.org", "DBT_CLOUD_RUN_REASON_CATEGORY": "other", "DBT_CLOUD_RUN_TRIGGER_CATEGORY": "RUN_REASON_CATEGORY_UI", "DBT_CLOUD_ENVIRONMENT_ID": "233228", "DBT_CLOUD_ACCOUNT_ID": "182221"}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.393306Z", "completed_at": "2024-01-21T22:02:06.394775Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.429130Z", "completed_at": "2024-01-21T22:02:06.429140Z"}], "thread_id": "Thread-12", "execution_time": 0.09608983993530273, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.cdo_analytics.seed_course_names", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.396030Z", "completed_at": "2024-01-21T22:02:06.398419Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.429831Z", "completed_at": "2024-01-21T22:02:06.429839Z"}], "thread_id": "Thread-13", "execution_time": 0.09002947807312012, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.cdo_analytics.seed_csf_plugged_stage_counts", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.401020Z", "completed_at": "2024-01-21T22:02:06.402336Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.434422Z", "completed_at": "2024-01-21T22:02:06.434429Z"}], "thread_id": "Thread-14", "execution_time": 0.09242415428161621, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.cdo_analytics.seed_csf_stages_for_completion", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.405847Z", "completed_at": "2024-01-21T22:02:06.407171Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.437427Z", "completed_at": "2024-01-21T22:02:06.437440Z"}], "thread_id": "Thread-15", "execution_time": 0.09422755241394043, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.cdo_analytics.seed_school_years", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.407830Z", "completed_at": "2024-01-21T22:02:06.409245Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.438453Z", "completed_at": "2024-01-21T22:02:06.438460Z"}], "thread_id": "Thread-16", "execution_time": 0.09094476699829102, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.cdo_analytics.seed_script_names", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.461798Z", "completed_at": "2024-01-21T22:02:06.463934Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.555797Z", "completed_at": "2024-01-21T22:02:06.555812Z"}], "thread_id": "Thread-1", "execution_time": 0.15248703956604004, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.cdo_analytics.seed_state_abbreviations", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.468241Z", "completed_at": "2024-01-21T22:02:06.469710Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.560646Z", "completed_at": "2024-01-21T22:02:06.560658Z"}], "thread_id": "Thread-2", "execution_time": 0.1610579490661621, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.cdo_analytics.seed_training_school_years", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.474990Z", "completed_at": "2024-01-21T22:02:06.476462Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.578656Z", "completed_at": "2024-01-21T22:02:06.578668Z"}], "thread_id": "Thread-3", "execution_time": 0.15907835960388184, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.cdo_analytics.seed_workshop_state_zip_manual", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.478598Z", "completed_at": "2024-01-21T22:02:06.551462Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.608311Z", "completed_at": "2024-01-21T22:02:06.608324Z"}], "thread_id": "Thread-4", "execution_time": 0.17386531829833984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__course_scripts", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard__course_scripts as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"course_scripts\"\n),\n\nrenamed as (\n    select\n        id as course_script_id,\n        course_id,\n        script_id,\n        position,\n        experiment_name,\n        default_script_id\n    from source\n)\n\nselect * \nfrom renamed\n), course_scripts as (\n    select * \n    from __dbt__cte__base_dashboard__course_scripts\n)\n\nselect * \nfrom course_scripts", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__course_scripts\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.483859Z", "completed_at": "2024-01-21T22:02:06.558397Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.610466Z", "completed_at": "2024-01-21T22:02:06.610475Z"}], "thread_id": "Thread-5", "execution_time": 0.17348861694335938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__followers", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard__followers as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"followers\"\n    where deleted_at is null \n),\n\nrenamed as (\n    select\n        id as follower_id,\n        student_user_id as student_id,\n        section_id,\n        created_at,\n        updated_at\n    from source\n)\n\nselect * \nfrom renamed\n), followers as (\n    select * \n    from __dbt__cte__base_dashboard__followers\n)\n\nselect * \nfrom followers", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__followers\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.487625Z", "completed_at": "2024-01-21T22:02:06.559619Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.612661Z", "completed_at": "2024-01-21T22:02:06.612670Z"}], "thread_id": "Thread-6", "execution_time": 0.1751251220703125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__levels", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard__levels as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"levels\"\n),\n\nrenamed as (\n    select\n        id                      as level_id,\n        game_id,\n        name,\n        created_at,\n        updated_at,\n        level_num,\n        ideal_level_source_id,\n        user_id,\n        properties,\n        type,\n        md5,\n        published               as is_published,\n        notes,\n        audit_log\n    from source\n)\n\nselect * \nfrom renamed\n), levels as (\n    select * \n    from __dbt__cte__base_dashboard__levels\n)\n\nselect * \nfrom levels", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__levels\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.493025Z", "completed_at": "2024-01-21T22:02:06.561576Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.614611Z", "completed_at": "2024-01-21T22:02:06.614619Z"}], "thread_id": "Thread-8", "execution_time": 0.1742563247680664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__levels_script_levels", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard__levels_script_levels as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"levels_script_levels\"\n),\n\nrenamed as (\n    select\n        level_id,\n        script_level_id\n    from source\n)\n\nselect * \nfrom renamed\n), level_script_levels as (\n    select * \n    from __dbt__cte__base_dashboard__levels_script_levels\n)\n\nselect * \nfrom level_script_levels", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__levels_script_levels\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.497292Z", "completed_at": "2024-01-21T22:02:06.566435Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.615374Z", "completed_at": "2024-01-21T22:02:06.615383Z"}], "thread_id": "Thread-7", "execution_time": 0.17403054237365723, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__school_districts", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard__school_districts as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"school_districts\"\n),\n\nrenamed as (\n    select\n        id      as school_district_id,\n        name    as school_district_name,\n        city    as school_district_city,\n        state   as school_district_state,\n        zip     as school_district_zip,\n        last_known_school_year_open,\n        created_at,\n        updated_at\n    from source\n)\n\nselect * \nfrom renamed\n), school_districts as (\n    select * \n    from __dbt__cte__base_dashboard__school_districts\n)\n\nselect * \nfrom school_districts", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__school_districts\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.500857Z", "completed_at": "2024-01-21T22:02:06.567205Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.616341Z", "completed_at": "2024-01-21T22:02:06.616350Z"}], "thread_id": "Thread-9", "execution_time": 0.17444825172424316, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__school_infos", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard__school_infos as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"school_infos\"\n),\n\nrenamed as (\n    select\n        id as school_info_id,\n        country,\n        school_type,\n        zip,\n        state,\n        school_district_id,\n        school_district_other,\n        school_district_name,\n        school_id,\n        school_other,\n        school_name,\n        full_address,\n        created_at,\n        updated_at,\n        validation_type\n    from source\n)\n\nselect * \nfrom renamed\n), school_infos as (\n    select * \n    from __dbt__cte__base_dashboard__school_infos\n)\n\nselect * \nfrom school_infos", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__school_infos\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.516705Z", "completed_at": "2024-01-21T22:02:06.585410Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.618918Z", "completed_at": "2024-01-21T22:02:06.618926Z"}], "thread_id": "Thread-11", "execution_time": 0.17423057556152344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__schools", "compiled": true, "compiled_code": "with  __dbt__cte__base_dashboard__schools as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"schools\"\n),\n\nrenamed as (\n    select\n        id                  as school_id,\n        school_district_id,\n        name                as school_name,\n        city,\n        state,\n        zip,\n        school_type,\n        created_at,\n        updated_at,\n        address_line1,\n        address_line2,\n        address_line3,\n        latitude,\n        longitude,\n        school_category,\n        last_known_school_year_open\n    from source\n)\n\nselect * \nfrom renamed\n), schools as (\n    select *\n    from __dbt__cte__base_dashboard__schools\n),\n\nfinal as (\n    select \n        case when len(school_id) = 11 \n             then lpad(school_id,12,'0') -- (js) adjustment to compensate for application dropping leading zeroes\n        else school_id \n        end as school_id,\n        school_district_id,\n        school_name,\n        city,\n        state,\n        zip,\n        school_type,\n        created_at,\n        updated_at,\n        address_line1,\n        address_line2,\n        address_line3,\n        latitude,\n        longitude,\n        school_category,\n        last_known_school_year_open\nfrom schools\n)\n\nselect *\nfrom final", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__schools\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.506518Z", "completed_at": "2024-01-21T22:02:06.595757Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.623689Z", "completed_at": "2024-01-21T22:02:06.623697Z"}], "thread_id": "Thread-10", "execution_time": 0.1801140308380127, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__school_stats_by_years", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard__school_stats_by_years as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"school_stats_by_years\"\n),\n\nrenamed as (\n    select\n        school_id,\n        school_year,\n\n        lower(grades_offered_lo) as grades_offered_lo,\n        lower(grades_offered_hi) as grades_offered_hi,\n        \n        grade_pk_offered    as is_grade_pk,\n        grade_kg_offered    as is_grade_kg,\n        grade_01_offered    as is_grade_01,\n        grade_02_offered    as is_grade_02,\n        grade_03_offered    as is_grade_03,\n        grade_04_offered    as is_grade_04,\n        grade_05_offered    as is_grade_05,\n        grade_06_offered    as is_grade_06,\n        grade_07_offered    as is_grade_07,\n        grade_08_offered    as is_grade_08,\n        grade_09_offered    as is_grade_09,\n        grade_10_offered    as is_grade_10,\n        grade_11_offered    as is_grade_11,\n        grade_12_offered    as is_grade_12,\n        grade_13_offered    as is_grade_13,\n        \n        community_type,\n        virtual_status,\n        title_i_status,\n        \n        coalesce(students_total,0)      as total_students,\n        coalesce(student_am_count,0)    as count_student_am,\n        coalesce(student_as_count,0)    as count_student_as,\n        coalesce(student_hi_count,0)    as count_student_hi,\n        coalesce(student_bl_count,0)    as count_student_bl,\n        coalesce(student_wh_count,0)    as count_student_wh,\n        coalesce(student_hp_count,0)    as count_student_hp,\n        coalesce(student_tr_count,0)    as count_student_tr,\n        coalesce(frl_eligible_total,0)  as total_frl_eligible_students,\n        \n        created_at,\n        updated_at\n    from source\n)\n\nselect * \nfrom renamed\n), school_stats_by_years as (\n    select * \n    from __dbt__cte__base_dashboard__school_stats_by_years\n),\n\nsurvey_years as (\n    select school_id,\n        min(school_year) as first_survey_year,\n        max(school_year) as survey_year\n    from school_stats_by_years  \ngroup by 1\n),\n\nschool_stats_2019_2020 as (\n    select school_id,\n        total_students,\n        total_frl_eligible_students\n    from school_stats_by_years\n    where school_year = '2019-2020'\n),\n\nschool_stats_by_years_adjusted as (\n    select \n        ssby.school_id,\n        school_year,\n        survey_year,\n        first_survey_year,\n        grades_offered_lo,\n        grades_offered_hi,\n        is_grade_pk,\n        is_grade_kg,\n        is_grade_01,\n        is_grade_02,\n        is_grade_03,\n        is_grade_04,\n        is_grade_05,\n        is_grade_06,\n        is_grade_07,\n        is_grade_08,\n        is_grade_09,\n        is_grade_10,\n        is_grade_11,\n        is_grade_12,\n        is_grade_13,\n        virtual_status,\n        title_i_status,\n\n        -- adjust for frl stop-gap logic\n        nullif(\n            case when survey_years.survey_year = '2020-2021'\n                and ssby.total_students is null \n                    then ssby2.total_students\n                else ssby.total_students\n        end, 0) as total_students,\n\n        count_student_am,\n        count_student_as,\n        count_student_hi,\n        count_student_bl,\n        count_student_wh,\n        count_student_hp,\n        count_student_tr,\n\n        -- adjustment for FRL logic\n        case when survey_year = '2020-2021'\n             and ssby.total_frl_eligible_students is null \n                then ssby2.total_frl_eligible_students\n            else ssby.total_frl_eligible_students \n        end as total_frl_eligible_students,\n\n        created_at,\n        updated_at,\n        community_type,\n\n        case when title_i_status in (1,2,3,4,5) \n                then 1\n            when title_i_status = 6 \n                then 0\n        end as is_title_i,\n\n        case when community_type in (\n                    'rural_fringe',\n                    'rural_distant',\n                    'rural_remote',\n                    'town_remote',\n                    'town_distant')\n                then 1 \n            when community_type is not null \n                then 0\n        end as is_rural,\n\n        case when grades_offered_lo is null then null \n             when grades_offered_lo in (\n                    '01',\n                    '02',\n                    '03',\n                    '04',\n                    '05',\n                    'PK',\n                    'KG')\n                then 1\n             when coalesce(\n                is_grade_pk,\n                is_grade_kg,\n                is_grade_01,\n                is_grade_02,\n                is_grade_03,\n                is_grade_04,\n                is_grade_04,\n                is_grade_05\n                ) = 1 then 1\n            else 0 \n        end as is_stage_el,\n        \n        case when grades_offered_lo = 'pk'\n              and grades_offered_hi = '06'\n                then 0\n             when grades_offered_lo = 'kg'\n              and grades_offered_hi = '06'\n                then 0\n             when coalesce(is_grade_06,is_grade_07,is_grade_08) = 1\n                then 1\n             when (grades_offered_lo in ('06','07','08')\n                or grades_offered_hi in ('06','07','08'))\n                then 1\n             when grades_offered_lo is null then null \n            else 0 \n        end as is_stage_mi,\n        \n        case when coalesce(\n                is_grade_09,\n                is_grade_10,\n                is_grade_11,\n                is_grade_12,\n                is_grade_13\n                ) = 1 then 1 \n             when grades_offered_hi in (\n                '09',\n                '10',\n                '11',\n                '12'\n             ) then 1 \n             when grades_offered_hi is null then null \n            else 0 \n        end as is_stage_hi \n\n    from school_stats_by_years as ssby\n    left join school_stats_2019_2020 as ssby2 \n        on ssby.school_id = ssby2.school_id\n    left join survey_years \n        on ssby.school_id = survey_years.school_id\n)\n\nselect * \nfrom school_stats_by_years_adjusted", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__school_stats_by_years\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.562514Z", "completed_at": "2024-01-21T22:02:06.604064Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.630984Z", "completed_at": "2024-01-21T22:02:06.630993Z"}], "thread_id": "Thread-12", "execution_time": 0.17320489883422852, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__script_levels", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard__script_levels as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"script_levels\"\n),\n\nrenamed as (\n    select\n        id                          as script_level_id,\n        script_id,\n        chapter,\n        created_at,\n        updated_at,\n        stage_id,\n        position,\n        assessment                  as is_assessment,\n        properties,\n        named_level                 as is_named_level,\n        bonus                       as is_bonus,\n        activity_section_id,\n        seed_key,\n        activity_section_position\n    from source\n)\n\nselect * \nfrom renamed\n), script_levels as (\n    select * \n    from __dbt__cte__base_dashboard__script_levels\n)\n\nselect * \nfrom script_levels", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__script_levels\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.567761Z", "completed_at": "2024-01-21T22:02:06.606412Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.632328Z", "completed_at": "2024-01-21T22:02:06.632339Z"}], "thread_id": "Thread-13", "execution_time": 0.17414546012878418, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__scripts", "compiled": true, "compiled_code": "with\n __dbt__cte__base_dashboard__scripts as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"scripts\"\n),\n\nrenamed as (\n    select\n        id as script_id,\n        name as script_name,\n        created_at,\n        updated_at,\n        wrapup_video_id,\n        user_id,\n        login_required,\n        properties,\n        new_name,\n        family_name,\n        published_state,\n        instruction_type,\n        instructor_audience,\n        participant_audience\n    from source\n)\n\nselect * \nfrom renamed\n), scripts as (\n    select\n        script_id,\n        script_name,\n        created_at,\n        updated_at,\n        wrapup_video_id,\n        user_id,\n        login_required,\n        new_name,\n        family_name,\n        published_state,\n        instruction_type,\n        instructor_audience,\n        participant_audience,\n        case\n            when lower(script_name) like 'devices-20__'                         then 'csd'\n            when lower(script_name) like 'microbit%'                            then 'csd'\n            when lower(script_name) like '%hello%'                              then 'hoc'\n            when lower(script_name) like 'csd-post-survey-20__'                 then 'csd'\n            when lower(script_name) like 'csp-post-survey-20__'                 then 'csp'\n            when\n                json_extract_path_text(properties, 'curriculum_umbrella') = ''  then 'other'\n            else\n                lower(json_extract_path_text(properties, 'curriculum_umbrella'))\n        end as course_name_true,\n        json_extract_path_text(properties, 'supported_locales') as supported_locales\n    from __dbt__cte__base_dashboard__scripts\n)\nselect * from scripts", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__scripts\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.581626Z", "completed_at": "2024-01-21T22:02:06.607602Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.634328Z", "completed_at": "2024-01-21T22:02:06.634336Z"}], "thread_id": "Thread-14", "execution_time": 0.16611528396606445, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__sections", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard__sections as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"sections\"\n    where deleted_at is null  \n),\n\nrenamed as (\n    select\n        -- section data\n        id                      as section_id,\n        name                    as section_name,\n        section_type,\n\n        user_id,\n        login_type,\n        code,\n        script_id,\n        course_id,\n        grade,\n        \n        -- flags \n        stage_extras            as is_stage_extras,\n        pairing_allowed         as is_pairing_allowed,\n        sharing_disabled        as is_sharing_disabled,\n        hidden                  as is_hidden,\n        tts_autoplay_enabled    as is_tts_autoplay_enabled,\n        restrict_section        as is_restrict_section,\n        participant_type,\n        -- properties,\n        \n        -- timestamps\n        created_at,\n        updated_at,\n        first_activity_at\n    from source\n)\n\nselect * \nfrom renamed\n), sections as (\n    select *\n    from __dbt__cte__base_dashboard__sections\n)\n\nselect * \nfrom sections", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__sections\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.588561Z", "completed_at": "2024-01-21T22:02:06.611861Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.639653Z", "completed_at": "2024-01-21T22:02:06.639662Z"}], "thread_id": "Thread-15", "execution_time": 0.1701958179473877, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__stages", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard__stages as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"stages\"\n),\n\nrenamed as (\n    select\n        id                  as stage_id,\n        name                as stage_name,\n        absolute_position,\n        script_id,\n        created_at,\n        updated_at,\n        lockable            as is_lockable,\n        relative_position,\n        -- properties,\n        lesson_group_id,\n        key,\n        has_lesson_plan\n    from source\n)\n\nselect * \nfrom renamed\n), stages as (\n    select \n        stage_id,\n        stage_name,\n        case when is_lockable = 1 then absolute_position else relative_position end as stage_number,\n        absolute_position,\n        script_id,\n        created_at,\n        updated_at,\n        is_lockable,\n        relative_position,\n        -- properties,\n        lesson_group_id,\n        key,\n        has_lesson_plan        \n    from __dbt__cte__base_dashboard__stages\n)\n\nselect * \nfrom stages", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__stages\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.596335Z", "completed_at": "2024-01-21T22:02:06.613916Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.641876Z", "completed_at": "2024-01-21T22:02:06.641884Z"}], "thread_id": "Thread-16", "execution_time": 0.18142938613891602, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__unit_groups", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard__unit_groups as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"unit_groups\"\n),\n\nrenamed as (\n    select\n        id as unit_group_id,\n        name,\n        properties,\n        created_at,\n        updated_at,\n        published_state,\n        instruction_type,\n        instructor_audience,\n        participant_audience\n    from source\n)\n\nselect * \nfrom renamed\n), unit_groups as (\n    select * \n    from __dbt__cte__base_dashboard__unit_groups\n)\n\nselect * \nfrom unit_groups", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__unit_groups\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.650576Z", "completed_at": "2024-01-21T22:02:06.696704Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.756923Z", "completed_at": "2024-01-21T22:02:06.756936Z"}], "thread_id": "Thread-1", "execution_time": 0.17142963409423828, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__user_geos", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard__user_geos as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production\".\"user_geos\"\n),\n\nrenamed as (\n    select\n        id as user_geo_id,\n        user_id,\n        created_at,\n        updated_at,\n        indexed_at,\n        city,\n        state,\n        lower(country) as country,\n        postal_code\n    from source\n)\n\nselect * \nfrom renamed\n), user_geos as (\n    select *,\n        row_number() over (partition by user_id order by user_geo_id desc) as row_number,\n        case when country = 'united states' then 0\n             when country <> 'united states' then 1 \n             else null \n        end as is_international\n    from __dbt__cte__base_dashboard__user_geos\n),\n\nfinal as (\n    select\n        -- pk\n        user_id,\n\n        -- geos \n        city,\n        state,\n        postal_code,\n        country,\n        is_international,\n        \n        -- dates\n        created_at,\n        updated_at,\n        indexed_at\n    from user_geos\n    where row_number = 1\n)\n\nselect *\nfrom final", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__user_geos\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.663242Z", "completed_at": "2024-01-21T22:02:06.700415Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.761754Z", "completed_at": "2024-01-21T22:02:06.761765Z"}], "thread_id": "Thread-2", "execution_time": 0.19029808044433594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__user_levels", "compiled": true, "compiled_code": "\n\nwith \n __dbt__cte__base_dashboard__user_levels as (\nwith \nsource as (\n      select * \n      from \"dashboard\".\"dashboard_production\".\"user_levels\"\n),\n\nrenamed as (\n    select\n        id                          as user_level_id,\n        user_id,\n        level_id,\n        script_id,\n        level_source_id,\n        attempts,\n        created_at,\n        updated_at,\n        best_result,\n        time_spent,\n        submitted                   as is_submitted,\n        readonly_answers            as is_read_only_answers,\n        unlocked_at\n        -- properties\n    from source\n)\n\nselect * \nfrom renamed\n), user_levels as (\n    select * \n    from __dbt__cte__base_dashboard__user_levels\n\n    \n\n    where updated_at > (select max(updated_at) from \"dev\".\"analytics\".\"stg_dashboard__user_levels\" )\n    \n    \n)\n\nselect * \nfrom user_levels", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__user_levels\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.679120Z", "completed_at": "2024-01-21T22:02:06.704234Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.779120Z", "completed_at": "2024-01-21T22:02:06.779131Z"}], "thread_id": "Thread-3", "execution_time": 0.18908429145812988, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard__users", "compiled": true, "compiled_code": "\n\nwith \n __dbt__cte__base_dashboard__users as (\nwith \nsource as (\n      select * \n      from \"dashboard\".\"dashboard_production\".\"users\"\n      --where deleted_at is null \n),\n\nrenamed as (\n    select\n        id                          as user_id,\n        studio_person_id,\n        sign_in_count,\n        current_sign_in_at,\n        last_sign_in_at,\n        created_at,\n        updated_at,\n        deleted_at,        \n        gender,\n        locale,\n        birthday,\n        user_type,\n        school_info_id,\n        total_lines,\n        active                      as is_active,\n        purged_at,\n        urm                         as is_urg,\n        races,\n        primary_contact_info_id\n    from source\n)\n\nselect * \nfrom renamed\n), users as (\n    select *\n    from __dbt__cte__base_dashboard__users\n    where is_active\n\n    \n\n    and updated_at > (select max(updated_at) from \"dev\".\"analytics\".\"stg_dashboard__users\" )\n    \n    \n),\n\nrenamed as (\n    select \n        -- PK\n        user_id,\n\n        -- FK's\n        case when user_type = 'student' then user_id end as student_id,\n        case when user_type = 'teacher' then user_id end as teacher_id,\n        studio_person_id,\n\n        -- user info\n        user_type,\n        datediff(year,birthday,current_date ) as age_years,\n        nullif(lower(gender),'') as gender,\n        is_urg,\n\n        -- misc.\n        locale,\n        sign_in_count,\n        school_info_id,\n        total_lines,\n\n        -- dates         \n        current_sign_in_at,\n        last_sign_in_at,\n        created_at,\n        updated_at,  \n        deleted_at,   \n        purged_at\n    from users\n)\n\nselect * \nfrom renamed", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard__users\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.704837Z", "completed_at": "2024-01-21T22:02:06.755800Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.822799Z", "completed_at": "2024-01-21T22:02:06.822814Z"}], "thread_id": "Thread-4", "execution_time": 0.18713164329528809, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard_pii__pd_enrollments", "compiled": true, "compiled_code": "with\n __dbt__cte__base_dashboard_pii__pd_enrollments as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production_pii\".\"pd_enrollments\"\n    where not deleted_at\n),\n\nrenamed as (\n    select\n        id as pd_enrollment_id,\n        pd_workshop_id,\n        name,\n        -- first_name,\n        -- last_name,\n        -- email,\n        created_at,\n        updated_at,\n        school,\n        code,\n        user_id,\n        survey_sent_at,\n        completed_survey_id,\n        school_info_id,\n        -- properties,\n        application_id\n    from source\n)\n\nselect * \nfrom renamed\n), pd_enrollments as (\n    select * \n    from __dbt__cte__base_dashboard_pii__pd_enrollments\n)\n\nselect * \nfrom pd_enrollments", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard_pii__pd_enrollments\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.709328Z", "completed_at": "2024-01-21T22:02:06.757643Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.827003Z", "completed_at": "2024-01-21T22:02:06.827016Z"}], "thread_id": "Thread-5", "execution_time": 0.18199372291564941, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard_pii__pd_applications", "compiled": true, "compiled_code": "with\n __dbt__cte__base_dashboard_pii__pd_applications as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production_pii\".\"pd_applications\"\n    where deleted_at is null\n),\n\nrenamed as (\n    select\n        id  as pd_application_id,\n        user_id,\n        type,\n        application_year,\n        application_type,\n        regional_partner_id,\n        status,\n        locked_at,\n        -- notes,\n        -- form_data,\n        created_at,\n        updated_at,\n        course,\n        response_scores,\n        application_guid,\n        accepted_at,\n        -- properties,\n        status_timestamp_change_log,\n        applied_at\n    from source\n)\n\nselect * \nfrom renamed\n), pd_applications as (\n    select * \n    from __dbt__cte__base_dashboard_pii__pd_applications\n)\n\nselect * \nfrom pd_applications", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard_pii__pd_applications\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.716949Z", "completed_at": "2024-01-21T22:02:06.759304Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.828162Z", "completed_at": "2024-01-21T22:02:06.828173Z"}], "thread_id": "Thread-6", "execution_time": 0.17984986305236816, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard_pii__pd_attendances", "compiled": true, "compiled_code": "with\n __dbt__cte__base_dashboard_pii__pd_attendances as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production_pii\".\"pd_attendances\"\n    where not deleted_at\n),\n\nrenamed as (\n    select\n        id as pd_attendance_id,\n        pd_session_id,\n        teacher_id,\n        created_at,\n        updated_at,\n        pd_enrollment_id,\n        marked_by_user_id\n    from source\n)\n\nselect * \nfrom renamed\n), pd_attendances as (\n    select * \n    from __dbt__cte__base_dashboard_pii__pd_attendances\n)\n\nselect * \nfrom pd_attendances", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard_pii__pd_attendances\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.722245Z", "completed_at": "2024-01-21T22:02:06.760665Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.829122Z", "completed_at": "2024-01-21T22:02:06.829131Z"}], "thread_id": "Thread-8", "execution_time": 0.16765403747558594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard_pii__pd_international_opt_ins", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard_pii__pd_international_opt_ins as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production_pii\".\"pd_international_opt_ins\"\n),\n\nrenamed as (\n    select \n        id as international_opt_in_id,\n        user_id,\n        form_data,\n        created_at,\n        updated_at\n    from source \n)\n\nselect *\nfrom renamed\n), international_opt_ins as (\n    select * \n    from __dbt__cte__base_dashboard_pii__pd_international_opt_ins\n),\n\nfinal as (\n    select \n        international_opt_in_id,\n        user_id                                             as teacher_user_id,\n        created_at                                          as form_submitted_at,\n        updated_at                                          as updated_at,\n\n        -- json_extract_path_text(form_data, 'firstName')           as first_name,\n        -- json_extract_path_text(form_data, 'firstNamePreferred')  as pref_name,\n        -- json_extract_path_text(form_data, 'lastName')            as last_name,\n        -- json_extract_path_text(form_data, 'email')               as email,\n        -- json_extract_path_text(form_data, 'emailAlternate')      as email_alt,\n        -- json_extract_path_text(form_data, 'gender')              as gender,\n        json_extract_path_text(form_data, 'schoolDepartment')    as school_department,\n        json_extract_path_text(form_data, 'schoolMunicipality')  as school_municipality,\n        json_extract_path_text(form_data, 'schoolName')          as school_name,\n        json_extract_path_text(form_data, 'schoolCity')          as school_city,\n        json_extract_path_text(form_data, 'schoolCountry')       as school_country,\n        json_extract_path_text(form_data, 'ages')                as age_taught,\n        json_extract_path_text(form_data, 'subjects')            as subject_taught,\n        json_extract_path_text(form_data, 'resources')           as cs_resources,\n        json_extract_path_text(form_data, 'robotics')            as robotics_resources,\n        json_extract_path_text(form_data, 'date')                as workshop_date,\n        json_extract_path_text(form_data, 'workshopOrganizer')   as workshop_organizer,\n        json_extract_path_text(form_data, 'workshopFacilitator') as workshop_facilitator,\n        json_extract_path_text(form_data, 'workshopCourse')      as workshop_course,\n        json_extract_path_text(form_data, 'emailOptIn')          as email_opt_in\n        \n    from international_opt_ins \n)\n\nselect * \nfrom final", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard_pii__pd_international_opt_ins\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.732453Z", "completed_at": "2024-01-21T22:02:06.761174Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.829873Z", "completed_at": "2024-01-21T22:02:06.829883Z"}], "thread_id": "Thread-7", "execution_time": 0.16797661781311035, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard_pii__pd_regional_partner_mappings", "compiled": true, "compiled_code": "with  __dbt__cte__base_dashboard_pii__pd_regional_partner_mappings as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production_pii\".\"pd_regional_partner_mappings\"\n    where not deleted_at\n),\n\nrenamed as (\n    select\n        id as pd_regional_partner_mapping_id,\n        regional_partner_id,\n        state,\n        zip_code,\n        created_at,\n        updated_at\n    from source\n)\n\nselect * \nfrom renamed\n), pd_regional_partner_mappings as (\n    select * \n    from __dbt__cte__base_dashboard_pii__pd_regional_partner_mappings\n)\n\nselect * \nfrom pd_regional_partner_mappings", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard_pii__pd_regional_partner_mappings\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.740765Z", "completed_at": "2024-01-21T22:02:06.774160Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.831432Z", "completed_at": "2024-01-21T22:02:06.831444Z"}], "thread_id": "Thread-9", "execution_time": 0.16918706893920898, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard_pii__pd_sessions", "compiled": true, "compiled_code": "with\n __dbt__cte__base_dashboard_pii__pd_sessions as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production_pii\".\"pd_sessions\"\n    where not deleted_at\n),\n\nrenamed as (\n    select\n        id                  as pd_session_id,\n        pd_workshop_id,\n        \"start\"             as started_at,\n        \"end\"               as ended_at,\n        created_at,\n        updated_at,\n        code\n    from source\n)\n\nselect * \nfrom renamed\n), pd_sessions as (\n    select * \n    from __dbt__cte__base_dashboard_pii__pd_sessions\n)\n\nselect * \nfrom pd_sessions", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard_pii__pd_sessions\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.746259Z", "completed_at": "2024-01-21T22:02:06.779822Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.835373Z", "completed_at": "2024-01-21T22:02:06.835383Z"}], "thread_id": "Thread-11", "execution_time": 0.1594865322113037, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard_pii__pd_workshop_facilitators", "compiled": true, "compiled_code": "with  __dbt__cte__base_dashboard_pii__pd_workshops_facilitators as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production_pii\".\"pd_workshops_facilitators\"\n),\n\nrenamed as (\n    select\n        pd_workshop_id,\n        user_id\n    from source\n)\n\nselect * \nfrom renamed\n), pd_workshop_facilitators as (\n    select * \n    from __dbt__cte__base_dashboard_pii__pd_workshops_facilitators\n)\n\nselect * \nfrom pd_workshop_facilitators", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard_pii__pd_workshop_facilitators\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.751348Z", "completed_at": "2024-01-21T22:02:06.793864Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.839286Z", "completed_at": "2024-01-21T22:02:06.839298Z"}], "thread_id": "Thread-10", "execution_time": 0.1601734161376953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard_pii__pd_workshops", "compiled": true, "compiled_code": "with\n __dbt__cte__base_dashboard_pii__pd_workshops as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production_pii\".\"pd_workshops\"\n    where not deleted_at\n),\n\nrenamed as (\n    select\n        id                  as pd_workshop_id,\n        organizer_id,\n        location_name,\n        location_address,\n        processed_location,\n        course,\n        subject,\n        capacity,\n        -- notes,\n        section_id,\n        started_at,\n        ended_at,\n        created_at,\n        updated_at,\n        processed_at,\n        regional_partner_id,\n        on_map              as is_on_map,\n        funded              as is_funded,\n        funding_type,\n        -- properties,\n        module -- (js) new col added (see: https://github.com/code-dot-org/code-dot-org/pull/53949/files)\n    from source\n)\n\nselect * \nfrom renamed\n), pd_workshops as (\n    select * \n    from __dbt__cte__base_dashboard_pii__pd_workshops\n)\n\nselect * \nfrom pd_workshops", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard_pii__pd_workshops\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.762593Z", "completed_at": "2024-01-21T22:02:06.818934Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.848753Z", "completed_at": "2024-01-21T22:02:06.848763Z"}], "thread_id": "Thread-12", "execution_time": 0.16160368919372559, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard_pii__regional_partners", "compiled": true, "compiled_code": "with  __dbt__cte__base_dashboard_pii__regional_partners as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production_pii\".\"regional_partners\"\n    where not deleted_at\n),\n\nrenamed as (\n    select\n        id                  as regional_partner_id,\n        \"group\"             as regional_partner_group,\n        name                as regional_partner_name,\n        urban               as is_urban,\n        attention,\n        street,\n        apartment_or_suite,\n        city,\n        state,\n        zip_code,\n        -- phone_number,\n        -- notes,\n        created_at,\n        updated_at,\n        -- properties,\n        is_active\n    from source\n)\n\nselect * \nfrom renamed\n), regional_partners as (\n    select * \n    from __dbt__cte__base_dashboard_pii__regional_partners\n)\n\nselect * \nfrom regional_partners", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard_pii__regional_partners\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.766668Z", "completed_at": "2024-01-21T22:02:06.819551Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.849584Z", "completed_at": "2024-01-21T22:02:06.849593Z"}], "thread_id": "Thread-13", "execution_time": 0.1618051528930664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard_pii__user_school_infos", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard_pii__user_school_infos as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production_pii\".\"user_school_infos\"\n),\n\nrenamed as (\n    select\n        id                      as user_school_info_id,\n        user_id,\n        start_date              as started_at,\n        end_date                as ended_at,\n        school_info_id,\n        last_confirmation_date  as last_confirmation_at,\n        created_at,\n        updated_at\n    from source\n)\n\nselect * \nfrom renamed\n), user_school_infos as (\n    select \n        user_school_info_id,\n        user_id,\n        started_at,\n        case when ended_at is not null then ended_at else '9999-12-31' end as ended_at,\n        school_info_id,\n        last_confirmation_at,\n        created_at,\n        updated_at \n    from __dbt__cte__base_dashboard_pii__user_school_infos\n)\n\nselect * \nfrom user_school_infos", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard_pii__user_school_infos\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.774833Z", "completed_at": "2024-01-21T22:02:06.823960Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.852988Z", "completed_at": "2024-01-21T22:02:06.852996Z"}], "thread_id": "Thread-14", "execution_time": 0.16414093971252441, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_dashboard_pii__users", "compiled": true, "compiled_code": "with \n __dbt__cte__base_dashboard_pii__users as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"dashboard_production_pii\".\"users\"\n    where not deleted_at\n),\n\nrenamed as (\n    select\n        id                          as user_id,\n        studio_person_id,\n        sign_in_count,\n        current_sign_in_at,\n        last_sign_in_at,\n        created_at,\n        updated_at,\n        -- username,\n        provider,\n        uid,\n        admin,\n        -- gender,\n        -- name,\n        locale,\n        -- birthday,\n        user_type,\n        school,\n        full_address,\n        school_info_id,\n        total_lines,\n        active                      as is_active,\n        purged_at,\n        invited_by_id,\n        invited_by_type,\n        terms_of_service_version,\n        urm                         as is_urm,\n        -- races,\n        primary_contact_info_id\n\n    from source\n)\n\nselect * \nfrom renamed\n), users as (\n    select * \n    from __dbt__cte__base_dashboard_pii__users\n)\n\nselect * \nfrom users", "relation_name": "\"dev\".\"analytics\".\"stg_dashboard_pii__users\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.780646Z", "completed_at": "2024-01-21T22:02:06.826090Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.856006Z", "completed_at": "2024-01-21T22:02:06.856019Z"}], "thread_id": "Thread-15", "execution_time": 0.1592872142791748, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_legacy_pii__international_partners", "compiled": true, "compiled_code": "with \n __dbt__cte__base_legacy_pii__international_partners as (\nwith \nsource as (\n      select * \n      from \"dev\".\"analytics_pii\".\"seed_international_partners\"\n)\n\nselect * \nfrom source\n), international_partners as (\n    select * \n    from __dbt__cte__base_legacy_pii__international_partners\n),\n\nrenamed as (\n    select         \n        -- partner data\n        partner_id,\n        partner                                                                             as partner_name,\n        case when partner_type = '' then 'public' else partner_type end                     as partner_type,\n\n        -- country data \n        country_cd                                                                          as country_code,\n        lower(display_name)                                                                 as country_name,\n        lower(alt_name)                                                                     as alt_country_name,\n        region,\n\n        --contact info\n        case when workshop_organizers = '' \n            then 'no partner' \n            else lower(workshop_organizers) end                                             as workshop_organizers,\n        contact_name,\n        contact_email -- @allison is this approved as well? (js) \n        -- exceptions -- unclear if needed, removing for now (js)\n    from international_partners\n)\n\nselect * \nfrom renamed", "relation_name": "\"dev\".\"analytics\".\"stg_legacy_pii__international_partners\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.795952Z", "completed_at": "2024-01-21T22:02:06.832563Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:06.861759Z", "completed_at": "2024-01-21T22:02:06.861769Z"}], "thread_id": "Thread-16", "execution_time": 0.16996359825134277, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_pegasus_pii__forms", "compiled": true, "compiled_code": "with \n __dbt__cte__base_pegasus_pii__forms as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"pegasus_pii\".\"forms\"\n),\n\nrenamed as (\n    select\n        id                      as form_id,\n        source_id,\n        email,\n        name,\n        kind                    as form_kind,\n        -- data                    as form_data,\n        created_at,\n        updated_at,\n        indexed_at,\n        review,\n        reviewed_by,\n        reviewed_at,\n        processed_at,\n        -- processed_data, \n        notified_at,\n        user_id,\n        parent_id,\n        location_country_code_s as location_country_code,\n        data_text               as form_data_text,  \n        processed_data_text\n    from source\n)\n\nselect * \nfrom renamed\n), forms as (\n    select \n        form_id,\n        case\n            when lower(form_kind) like 'hocsignup%' then 'hoc'\n            when lower(form_kind) = 'professionaldevelopmentworkshop' then 'pd'\n            else lower(form_kind)\n        end                                                             as form_category,\n        case \n            when lower(form_kind) like 'hocsignup%' \n            then right(form_kind,4) \n            else null \n        end                                                             as hoc_year,\n        email,\n        name,\n        form_kind,\n        -- form_data,\n        created_at,\n        updated_at,\n        indexed_at,\n        review,\n        reviewed_by,\n        reviewed_at,\n        processed_at,\n        -- processed_data, \n        notified_at,\n        user_id,\n        parent_id,\n        location_country_code,\n        -- form_data_text,  \n        -- processed_data_text,\n        nullif(json_extract_path_text(processed_data_text, 'location_city_s', true), '')      as city,\n        nullif(json_extract_path_text(processed_data_text, 'location_state_s', true), '')     as state,\n        nullif(json_extract_path_text(processed_data_text, 'location_country_s', true), '')   as country,\n        nullif(json_extract_path_text(form_data_text, 'event_type_s', true), '')              as event_type,\n        nullif(json_extract_path_text(form_data_text, 'email_preference_opt_in_s', true), '') as email_pref\n    from __dbt__cte__base_pegasus_pii__forms\n)\n\nselect * \nfrom forms", "relation_name": "\"dev\".\"analytics\".\"stg_pegasus_pii__forms\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.868609Z", "completed_at": "2024-01-21T22:02:06.906519Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.002480Z", "completed_at": "2024-01-21T22:02:07.002494Z"}], "thread_id": "Thread-1", "execution_time": 0.20122957229614258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_pegasus_pii__form_geos", "compiled": true, "compiled_code": "with \n __dbt__cte__base_pegasus_pii__form_geos as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"pegasus_pii\".\"form_geos\"\n),\n\nrenamed as (\n    select\n        id as form_geo_id,\n        form_id,\n        created_at,\n        updated_at,\n        \n        city,\n        state,\n        country,\n        postal_code\n        \n    from source\n)\n\nselect * \nfrom renamed\n), form_geos as (\n    select *\n    from __dbt__cte__base_pegasus_pii__form_geos\n)\n\nselect * \nfrom form_geos", "relation_name": "\"dev\".\"analytics\".\"stg_pegasus_pii__form_geos\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.879962Z", "completed_at": "2024-01-21T22:02:06.911612Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.008055Z", "completed_at": "2024-01-21T22:02:07.008067Z"}], "thread_id": "Thread-2", "execution_time": 0.20554566383361816, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.stg_pegasus_pii__hoc_activity", "compiled": true, "compiled_code": "\n\nwith\n __dbt__cte__base_pegasus_pii__hoc_activity as (\nwith \nsource as (\n    select * \n    from \"dashboard\".\"pegasus_pii\".\"hoc_activity\"\n),\n\nrenamed as (\n    select\n        id                                      as hoc_activity_id,\n        referer,\n        company,\n        tutorial,\n        started_at,\n        pixel_started_at,\n        country_code,\n        state_code,\n        city,\n        country,\n        state\n    from source\n)\n\nselect * \nfrom renamed\n), hoc_activity as (\n    select\n        hoc_activity_id,\n        referer,\n        company,\n        tutorial,\n        coalesce(started_at, pixel_started_at)                      as started_at,\n        case when pixel_started_at is not null then 1 else 0 end    as is_third_party,\n        country_code,\n        state_code,\n        city,\n        country,\n        state\n    from __dbt__cte__base_pegasus_pii__hoc_activity\n    \n\n    where started_at > (select max(started_at) from \"dev\".\"analytics\".\"stg_pegasus_pii__hoc_activity\" )\n    \n    \n)\n\nselect *\nfrom hoc_activity", "relation_name": "\"dev\".\"analytics\".\"stg_pegasus_pii__hoc_activity\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.893814Z", "completed_at": "2024-01-21T22:02:06.919997Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.027612Z", "completed_at": "2024-01-21T22:02:07.027624Z"}], "thread_id": "Thread-3", "execution_time": 0.20351243019104004, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.redshift.redshift_admin_dependencies", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__pg_class as (\nselect\n  oid\n, relname\n, relnamespace\n, reltype\n, relowner\n, relam\n, relfilenode\n, reltablespace\n, relpages\n, reltuples\n, reltoastrelid\n, reltoastidxid\n, relhasindex\n, relisshared\n, relkind\n, relnatts\n, relexternid\n, relisreplicated\n, relispinned\n, reldiststyle\n, relprojbaseid\n, relchecks\n, reltriggers\n, relukeys\n, relfkeys\n, relrefs\n, relhasoids\n, relhaspkey\n, relhasrules\n, relhassubclass\n, relacl\nfrom pg_catalog.pg_class\n),  __dbt__cte__pg_depend as (\nselect\n  classid\n, objid\n, objsubid\n, refclassid\n, refobjid\n, refobjsubid\n, deptype\nfrom pg_catalog.pg_depend\n),  __dbt__cte__pg_namespace as (\nselect\n  oid\n, nspname\n, nspowner\n, nspacl\nfrom pg_catalog.pg_namespace\n) select distinct\n  srcobj.oid as source_oid\n  , srcnsp.nspname as source_schemaname\n  , srcobj.relname as source_objectname\n  , tgtobj.oid as dependent_oid\n  , tgtnsp.nspname as dependent_schemaname\n  , tgtobj.relname as dependent_objectname\n\nfrom\n\n  __dbt__cte__pg_class as srcobj\n  join __dbt__cte__pg_depend as srcdep on srcobj.oid = srcdep.refobjid\n  join __dbt__cte__pg_depend as tgtdep on srcdep.objid = tgtdep.objid\n  join __dbt__cte__pg_class as tgtobj\n    on tgtdep.refobjid = tgtobj.oid\n    and srcobj.oid <> tgtobj.oid\n  left join __dbt__cte__pg_namespace as srcnsp\n    on srcobj.relnamespace = srcnsp.oid\n  left join __dbt__cte__pg_namespace tgtnsp on tgtobj.relnamespace = tgtnsp.oid\n\nwhere\n  tgtdep.deptype = 'i' --dependency_internal\n  and tgtobj.relkind = 'v' --i=index, v=view, s=sequence", "relation_name": "\"dev\".\"analytics\".\"redshift_admin_dependencies\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.914909Z", "completed_at": "2024-01-21T22:02:07.003246Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.058668Z", "completed_at": "2024-01-21T22:02:07.058679Z"}], "thread_id": "Thread-4", "execution_time": 0.20597386360168457, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.redshift.redshift_admin_users_schema_privileges", "compiled": true, "compiled_code": "with  __dbt__cte__pg_tables as (\nselect\n  schemaname as schema_name\n, tablename as table_name\n, tableowner as table_owner\n, tablespace as table_space\n, hasindexes as has_indexes\n, hasrules as has_rules\n, hastriggers as has_triggers\nfrom pg_catalog.pg_tables\n),  __dbt__cte__pg_views as (\nselect\n  schemaname as schema_name\n, viewname as view_name\n, viewowner as view_owner\nfrom pg_catalog.pg_views\n),  __dbt__cte__pg_user as (\nselect\n\n  usesysid as user_id\n, usename as username\n\nfrom pg_catalog.pg_user\n), tables as (\n\n  select * from __dbt__cte__pg_tables\n\n), views as (\n\n  select * from __dbt__cte__pg_views\n\n), users as (\n\n  select * from __dbt__cte__pg_user\n  \n), schemas as (\n  \n  select\n  distinct(schema_name)\n  from tables\n  where schema_name not in ('pg_catalog', 'information_schema')\n        \n  union\n        \n  select\n  distinct(schema_name)\n  from views\n        \n  where schema_name not in ('pg_catalog', 'information_schema')\n  \n)\n\n\nselect \n  schemas.schema_name\n, users.username\n, has_schema_privilege(users.username, schemas.schema_name, 'usage') AS has_usage_privilege\n, has_schema_privilege(users.username, schemas.schema_name, 'create') AS has_create_privilege\nfrom schemas\ncross join users\norder by schemas.schema_name, users.username", "relation_name": "\"dev\".\"analytics\".\"redshift_admin_users_schema_privileges\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.926884Z", "completed_at": "2024-01-21T22:02:07.005181Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.062379Z", "completed_at": "2024-01-21T22:02:07.062394Z"}], "thread_id": "Thread-5", "execution_time": 0.19925165176391602, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.redshift.redshift_admin_users_table_view_privileges", "compiled": true, "compiled_code": "with  __dbt__cte__pg_tables as (\nselect\n  schemaname as schema_name\n, tablename as table_name\n, tableowner as table_owner\n, tablespace as table_space\n, hasindexes as has_indexes\n, hasrules as has_rules\n, hastriggers as has_triggers\nfrom pg_catalog.pg_tables\n),  __dbt__cte__pg_views as (\nselect\n  schemaname as schema_name\n, viewname as view_name\n, viewowner as view_owner\nfrom pg_catalog.pg_views\n),  __dbt__cte__pg_user as (\nselect\n\n  usesysid as user_id\n, usename as username\n\nfrom pg_catalog.pg_user\n), tables as (\n\n  select * from __dbt__cte__pg_tables\n\n), views as (\n\n  select * from __dbt__cte__pg_views\n\n), users as (\n\n  select * from __dbt__cte__pg_user\n\n), objects as (\n  \n  select\n    schema_name\n  , 'table' as object_type\n  , table_name as object_name\n  , '\"' || schema_name || '\".\"' || table_name || '\"' as full_object_name\n  from tables\n  where schema_name not in ('pg_catalog', 'information_schema')\n  \n  union\n  \n  select\n    schema_name\n  , 'view' as object_type\n  , view_name as object_name\n  , '\"' || schema_name || '\".\"' || view_name || '\"' as full_object_name\n  from views\n  where schema_name not in ('pg_catalog', 'information_schema')\n  \n)\n\nselect \n  objects.schema_name\n, objects.object_name\n, users.username\n, has_table_privilege(users.username, objects.full_object_name, 'select') as has_select_privilege\n, has_table_privilege(users.username, objects.full_object_name, 'insert') as has_insert_privilege\n, has_table_privilege(users.username, objects.full_object_name, 'update') as has_update_privilege\n, has_table_privilege(users.username, objects.full_object_name, 'delete') as has_delete_privilege\n, has_table_privilege(users.username, objects.full_object_name, 'references') as has_references_privilege\nfrom objects\ncross join users\norder by objects.full_object_name, users.username", "relation_name": "\"dev\".\"analytics\".\"redshift_admin_users_table_view_privileges\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.967075Z", "completed_at": "2024-01-21T22:02:07.005716Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.063577Z", "completed_at": "2024-01-21T22:02:07.063586Z"}], "thread_id": "Thread-7", "execution_time": 0.19793486595153809, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_course_names", "compiled": true, "compiled_code": "with \ncourse_names as (\n    select * \n    from \"dev\".\"analytics\".\"seed_course_names\"\n)\n\nselect * \nfrom course_names", "relation_name": "\"dev\".\"analytics\".\"dim_course_names\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.956681Z", "completed_at": "2024-01-21T22:02:07.007226Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.064349Z", "completed_at": "2024-01-21T22:02:07.064358Z"}], "thread_id": "Thread-8", "execution_time": 0.19988536834716797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.redshift.redshift_admin_table_stats", "compiled": true, "compiled_code": "with  __dbt__cte__stv_tbl_perm as (\nselect\n  slice\n, id -- table id\n, name -- table name\n, rows\n, sorted_rows\n, (rows - sorted_rows) as unsorted_rows\n, temp\n, db_id\n, backup\nfrom pg_catalog.stv_tbl_perm\n),  __dbt__cte__pg_class as (\nselect\n  oid\n, relname\n, relnamespace\n, reltype\n, relowner\n, relam\n, relfilenode\n, reltablespace\n, relpages\n, reltuples\n, reltoastrelid\n, reltoastidxid\n, relhasindex\n, relisshared\n, relkind\n, relnatts\n, relexternid\n, relisreplicated\n, relispinned\n, reldiststyle\n, relprojbaseid\n, relchecks\n, reltriggers\n, relukeys\n, relfkeys\n, relrefs\n, relhasoids\n, relhaspkey\n, relhasrules\n, relhassubclass\n, relacl\nfrom pg_catalog.pg_class\n),  __dbt__cte__pg_namespace as (\nselect\n  oid\n, nspname\n, nspowner\n, nspacl\nfrom pg_catalog.pg_namespace\n),  __dbt__cte__stv_blocklist as (\nselect\n  slice\n, col\n, tbl\n, blocknum\n, num_values\n, extended_limits\n, minvalue\n, maxvalue\n, sb_pos\n, pinned\n, on_disk\n, backed_up\n, modified\n, hdr_modified\n, unsorted\n, tombstone\n, preferred_diskno\n, temporary\n, newblock\n, num_readers\n, id\n, flags\nfrom pg_catalog.stv_blocklist\n),  __dbt__cte__pg_attribute as (\nselect\n  attrelid\n, attname\n, atttypid\n, attstattarget\n, attlen\n, attnum\n, attndims\n, attcacheoff\n, atttypmod\n, attbyval\n, attstorage\n, attalign\n, attnotnull\n, atthasdef\n, attisdropped\n, attislocal\n, attinhcount\n, attisdistkey\n, attispreloaded\n, attsortkeyord\n, attencodingtype\n, attencrypttype\n, (case attisdistkey\n        when 't' then attname\n        else null end) as dist_key\n, (case attsortkeyord\n        when 1 then attname\n        else null end) as sort_key\nfrom pg_catalog.pg_attribute\n),  __dbt__cte__svv_diskusage as (\nselect\n  db_id\n, name\n, slice\n, col\n, tbl\n, blocknum\n, num_values\n, extended_limits\n, minvalue\n, maxvalue\n, sb_pos\n, pinned\n, on_disk\n, backed_up\n, modified\n, hdr_modified\n, unsorted\n, tombstone\n, preferred_diskno\n, temporary\n, newblock\n, num_readers\n, id\n, flags\nfrom pg_catalog.svv_diskusage\n),  __dbt__cte__stv_partitions as (\nselect\n\n  owner\n, host\n, diskno\n, part_begin\n, part_end\n, used\n, tossed\n, capacity\n, \"reads\"\n, writes\n, seek_forward\n, seek_back\n, is_san\n, failed\n, mbps\n, mount\n\nfrom pg_catalog.stv_partitions\n), unsorted_by_table as (\n\n  select\n    db_id\n  , id as table_id\n  , name as table_name\n  , sum(rows) as rows\n  , sum(unsorted_rows) as unsorted_rows\n  from __dbt__cte__stv_tbl_perm\n  group by 1, 2, 3\n\n), pg_class as (\n\n  select * from __dbt__cte__pg_class\n\n), pg_namespace as (\n\n  select * from __dbt__cte__pg_namespace\n\n), table_sizes as (\n\n  select\n    tbl as table_id\n  , count(*) as size_in_megabytes\n  from __dbt__cte__stv_blocklist\n  group by 1\n\n), table_attributes as (\n\n  select\n    attrelid as table_id\n  , min(dist_key) as dist_key\n  , min(sort_key) as sort_key\n  , max(attsortkeyord) as num_sort_keys\n  , (max(attencodingtype) > 0) as is_encoded\n  , max(attnum) as num_columns\n  from __dbt__cte__pg_attribute\n  group by 1\n\n), slice_distribution as (\n\n  select\n    tbl as table_id\n  , trim(name) as name\n  , slice\n  , count(*) as size_in_megabytes\n\n  from __dbt__cte__svv_diskusage\n  group by 1, 2, 3\n\n), capacity as (\n\n  select\n    sum(capacity) as total_megabytes\n  from __dbt__cte__stv_partitions\n  where part_begin=0\n\n), table_distribution_ratio as (\n\n  select\n    table_id\n  , (max(size_in_megabytes)::float / min(size_in_megabytes)::float)\n      as ratio\n  from slice_distribution\n  group by 1\n\n)\n\nselect\n\n  trim(pg_namespace.nspname) as schema\n, trim(unsorted_by_table.table_name) as table\n, unsorted_by_table.rows\n, unsorted_by_table.unsorted_rows\n, (case unsorted_by_table.rows\n        when 0 then 0\n        else (unsorted_by_table.unsorted_rows::float / unsorted_by_table.rows::float) * 100.0 end)\n    as percent_rows_unsorted\n, unsorted_by_table.table_id\n\n, decode(pg_class.reldiststyle, 0, 'even',\n                              1, table_attributes.dist_key,\n                              'all') as dist_style\n, table_distribution_ratio.ratio as dist_skew\n\n, (table_attributes.sort_key is not null) as is_sorted\n, table_attributes.sort_key\n, table_attributes.num_sort_keys\n, table_attributes.num_columns\n\n, table_sizes.size_in_megabytes\n, (case capacity.total_megabytes\n        when 0 then 0\n        else (table_sizes.size_in_megabytes::float / capacity.total_megabytes::float) * 100.0 end)\n    as disk_used_percent_of_total\n, table_attributes.is_encoded\n\nfrom unsorted_by_table\n\nleft join pg_class\n  on pg_class.oid = unsorted_by_table.table_id\n\nleft join pg_namespace\n  on pg_namespace.oid = pg_class.relnamespace\n\nleft join capacity\n  on 1=1\n\nleft join table_sizes\n  on unsorted_by_table.table_id = table_sizes.table_id\n\nleft join table_attributes\n  on table_attributes.table_id = unsorted_by_table.table_id\n\nleft join table_distribution_ratio\n  on table_distribution_ratio.table_id = unsorted_by_table.table_id", "relation_name": "\"dev\".\"analytics\".\"redshift_admin_table_stats\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.984850Z", "completed_at": "2024-01-21T22:02:07.008829Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.066672Z", "completed_at": "2024-01-21T22:02:07.066684Z"}], "thread_id": "Thread-9", "execution_time": 0.19089293479919434, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_script_names", "compiled": true, "compiled_code": "with \nscript_names as (\n    select * \n    from \"dev\".\"analytics\".\"seed_script_names\"\n)\n\nselect * \nfrom script_names", "relation_name": "\"dev\".\"analytics\".\"dim_script_names\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.992744Z", "completed_at": "2024-01-21T22:02:07.033705Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.069184Z", "completed_at": "2024-01-21T22:02:07.069193Z"}], "thread_id": "Thread-11", "execution_time": 0.18136024475097656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.int_school_weeks", "compiled": true, "compiled_code": "\n\n-- Next 3 CTEs are SQL-y way of generating all the days (dates) from the beginning of code.org\n-- time, culminating in the CTE 'date_range'\nwith \n\nschool_years as (\n    select * \n    from \"dev\".\"analytics\".\"seed_school_years\"\n),\n\nnumbers_small as (\n    select 0 as num\n    union all\n    select 1\n    union all\n    select 2\n    union all\n    select 3\n    union all\n    select 4\n    union all\n    select 5\n    union all\n    select 6\n    union all\n    select 7\n    union all\n    select 8\n    union all\n    select 9\n),\n\nnumbers_large as (\n    select a.num + 10 * b.num + 100 * c.num + 1000 * d.num + 10000 * e.num as num\n    from numbers_small as a\n    cross join numbers_small as b\n    cross join numbers_small as c\n    cross join numbers_small as d\n    cross join numbers_small as e\n),\n\ndate_range as (\n    select\n        sy.school_year,\n        '2013-07-01'::date + num as date,\n        date_part(week, date) as iso_week\n    from numbers_large\n    left join school_years sy\n        on\n            '2013-07-01'::date\n            + num between sy.started_at::date and sy.ended_at::date\n    where '2013-07-01'::date + num <= '2030-06-30'::date\n),\n\nflagged_week_changes as (\n    select\n        dr.*,\n        lag(iso_week) over (order by date) as prev_iso_week,\n\n        -- 'flag' dates where an iso week changes, or the school year changes (july 1)\n        case\n            when\n                iso_week != prev_iso_week\n                or (date_part(month, date) = 7 and date_part(day, date) = 1)\n            then 'flag'\n        end as week_change\n    from date_range dr\n),\n\nschool_week_calc as (\n    select\n        *,\n        -- the school year week is the sum of all the \"flagged\" iso_week changes, including july 1, partition by school year so counting starts over each july 1\n        sum(\n            case \n                when week_change = 'flag' \n                then 1 \n                else 0 \n            end)\n            over (\n                partition by school_year\n                order by date rows between unbounded preceding and current row\n            ) as school_year_week\n    from flagged_week_changes\n)\n\nselect\n    school_year,\n    iso_week::integer,\n    school_year_week::integer,\n    min(date)::timestamp as started_at,     --0:0:0 on start date\n    dateadd(s, -1, max(date)+1) as ended_at,  --subtract 1 second from the next day to give 23:59:59 on end date\n    datediff('day',started_at,ended_at)+1 as days_interval\nfrom school_week_calc\ngroup by\n    school_year,\n    iso_week,\n    school_year_week", "relation_name": "\"dev\".\"analytics\".\"int_school_weeks\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:06.997562Z", "completed_at": "2024-01-21T22:02:07.041226Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.073255Z", "completed_at": "2024-01-21T22:02:07.073264Z"}], "thread_id": "Thread-10", "execution_time": 0.18304705619812012, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.int_school_years", "compiled": true, "compiled_code": "\n\nwith \nschool_years as (\n    select\n        school_year::varchar,\n        school_year_int::integer,\n        started_at::timestamp,\n        ended_at::timestamp,\n        school_year_long::varchar\n    from \"dev\".\"analytics\".\"seed_school_years\"\n)\n\n\nselect *\nfrom school_years\nwhere current_date >= started_at", "relation_name": "\"dev\".\"analytics\".\"int_school_years\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.009621Z", "completed_at": "2024-01-21T22:02:07.054832Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.082983Z", "completed_at": "2024-01-21T22:02:07.082993Z"}], "thread_id": "Thread-12", "execution_time": 0.18428444862365723, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.not_null_stg_dashboard__followers_follower_id.8675db9e61", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect follower_id\nfrom \"dev\".\"analytics\".\"stg_dashboard__followers\"\nwhere follower_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.020048Z", "completed_at": "2024-01-21T22:02:07.055910Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.084883Z", "completed_at": "2024-01-21T22:02:07.084893Z"}], "thread_id": "Thread-13", "execution_time": 0.18532490730285645, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.not_null_stg_dashboard__followers_student_id.d0d21c3ffe", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect student_id\nfrom \"dev\".\"analytics\".\"stg_dashboard__followers\"\nwhere student_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.028604Z", "completed_at": "2024-01-21T22:02:07.057198Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.085686Z", "completed_at": "2024-01-21T22:02:07.085695Z"}], "thread_id": "Thread-14", "execution_time": 0.17566299438476562, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.unique_stg_dashboard__followers_follower_id.37c6c5ee61", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    follower_id as unique_field,\n    count(*) as n_records\n\nfrom \"dev\".\"analytics\".\"stg_dashboard__followers\"\nwhere follower_id is not null\ngroup by follower_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.035885Z", "completed_at": "2024-01-21T22:02:07.061365Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.089955Z", "completed_at": "2024-01-21T22:02:07.089968Z"}], "thread_id": "Thread-15", "execution_time": 0.18598675727844238, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_levels", "compiled": true, "compiled_code": "with \nlevels as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__levels\"\n)\n\nselect * \nfrom levels", "relation_name": "\"dev\".\"analytics\".\"dim_levels\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.044320Z", "completed_at": "2024-01-21T22:02:07.065645Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.093831Z", "completed_at": "2024-01-21T22:02:07.093840Z"}], "thread_id": "Thread-16", "execution_time": 0.12954330444335938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.not_null_stg_dashboard__schools_school_id.dca2bd97dd", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect school_id\nfrom \"dev\".\"analytics\".\"stg_dashboard__schools\"\nwhere school_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.100738Z", "completed_at": "2024-01-21T22:02:07.136056Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.185090Z", "completed_at": "2024-01-21T22:02:07.185103Z"}], "thread_id": "Thread-1", "execution_time": 0.14268183708190918, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.unique_stg_dashboard__schools_school_id.a9b6308569", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    school_id as unique_field,\n    count(*) as n_records\n\nfrom \"dev\".\"analytics\".\"stg_dashboard__schools\"\nwhere school_id is not null\ngroup by school_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.107241Z", "completed_at": "2024-01-21T22:02:07.138667Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.187331Z", "completed_at": "2024-01-21T22:02:07.187342Z"}], "thread_id": "Thread-6", "execution_time": 0.1468353271484375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_school_stats_by_years", "compiled": true, "compiled_code": "-- Note: this data is built using NCES data recevied\n\nwith \nschool_stats_by_years as (\n    select \n        *,\n\n        -- pre-process these totals here\n        sum(count_student_am \n            + count_student_hi\n            + count_student_bl\n            + count_student_hp)\n        as total_urg_no_tr_students,\n\n        sum(count_student_am\n            + count_student_hi\n            + count_student_bl\n            + count_student_hp\n            + count_student_tr)\n         as total_urg_students,\n\n        sum(count_student_am  \n            + count_student_as  \n            + count_student_hi  \n            + count_student_bl  \n            + count_student_wh  \n            + count_student_hp\n            + count_student_tr)\n        as total_students_calculated\n\n    from \"dev\".\"analytics\".\"stg_dashboard__school_stats_by_years\"\n    \n    group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40\n),\n\ncombined as (\n    select \n        *,\n\n        -- calculations \n        total_urg_students / nullif(total_students_calculated,0)::float as urg_percent,\n\n        total_urg_no_tr_students / nullif(total_students_calculated,0)::float as urg_no_tr_percent,\n\n        -- case when total_students_calculated / total_students >= .7\n        --      then total_urg_students / total_students_calculated\n        -- end as urg_percent_true,\n        \n        total_frl_eligible_students / nullif(total_students,0)::float as frl_eligible_percent\n\n    from school_stats_by_years\n)\n\nselect *\nfrom combined", "relation_name": "\"dev\".\"analytics\".\"dim_school_stats_by_years\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.114890Z", "completed_at": "2024-01-21T22:02:07.142048Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.191109Z", "completed_at": "2024-01-21T22:02:07.191119Z"}], "thread_id": "Thread-2", "execution_time": 0.15015006065368652, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_schools", "compiled": true, "compiled_code": "-- Model: dim_schools\n-- Scope: all dimensions we have/need for schools; one row per school + school_year\nwith\nschools as (\n    select *\n    from \"dev\".\"analytics\".\"stg_dashboard__schools\"\n),\n\nschool_districts as (\n    select *\n    from \"dev\".\"analytics\".\"stg_dashboard__school_districts\"\n),\n\nschool_stats_by_years as (\n    select *, row_number() over(partition by school_id order by school_year desc) as row_num\n    from \"dev\".\"analytics\".\"stg_dashboard__school_stats_by_years\"\n),\n\ncombined as (\n    select\n        -- schools\n        schools.school_id,\n        schools.city,\n        schools.state,\n        schools.zip,\n        school_stats_by_years.school_year,\n        school_stats_by_years.is_stage_el,\n        school_stats_by_years.is_stage_mi,\n        school_stats_by_years.is_stage_hi,\n        (\n            (case when school_stats_by_years.is_stage_el = 1 then 'el' else '__' end ) ||\n            (case when school_stats_by_years.is_stage_mi = 1 then 'mi' else '__' end ) ||\n            (case when school_stats_by_years.is_stage_hi = 1 then 'hi' else '__' end ) \n        ) as school_level_simple,\n        school_stats_by_years.is_rural,\n        school_stats_by_years.is_title_i,\n        school_stats_by_years.community_type,\n        schools.school_category,\n        schools.school_name,\n        schools.school_type,\n        case when total_frl_eligible_students / total_students::float > 0.5\n            then 1 else 0 \n        end as is_high_needs,\n        schools.last_known_school_year_open,\n\n        --school_districts\n        school_districts.school_district_id,\n        school_districts.school_district_name,\n\n        -- nces school metrics\n        school_stats_by_years.total_students,\n        school_stats_by_years.count_student_am,\n        school_stats_by_years.count_student_as,\n        school_stats_by_years.count_student_hi,\n        school_stats_by_years.count_student_bl,\n        school_stats_by_years.count_student_wh,\n        school_stats_by_years.count_student_hp,\n        school_stats_by_years.count_student_tr,\n        school_stats_by_years.total_frl_eligible_students,\n\n        nullif(\n            sum(school_stats_by_years.count_student_am \n                + school_stats_by_years.count_student_hi\n                + school_stats_by_years.count_student_bl\n                + school_stats_by_years.count_student_hp)\n            ,0) as total_urg_no_tr_students,\n\n        nullif(\n            sum(school_stats_by_years.count_student_am\n                + school_stats_by_years.count_student_hi\n                + school_stats_by_years.count_student_bl\n                + school_stats_by_years.count_student_hp\n                + school_stats_by_years.count_student_tr)\n            ,0) as total_urg_students,\n\n        nullif(\n            sum(school_stats_by_years.count_student_am  \n                + school_stats_by_years.count_student_as  \n                + school_stats_by_years.count_student_hi  \n                + school_stats_by_years.count_student_bl  \n                + school_stats_by_years.count_student_wh  \n                + school_stats_by_years.count_student_hp\n                + school_stats_by_years.count_student_tr)\n            ,0) as total_students_calculated,\n        \n        -- calculations \n        total_urg_students / total_students_calculated::float as urg_percent,\n\n        total_urg_no_tr_students / total_students_calculated::float as urg_no_tr_percent,\n        \n        total_frl_eligible_students / total_students::float as frl_eligible_percent,\n        \n        -- dates \n        min(schools.created_at) as school_created_at,\n        max(schools.updated_at) as school_last_updated_at\n    from schools\n    left join school_stats_by_years\n        on schools.school_id = school_stats_by_years.school_id\n        and school_stats_by_years.row_num = 1\n    left join school_districts\n        on schools.school_district_id = school_districts.school_district_id\n    group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28\n)\n\nselect *\nfrom combined", "relation_name": "\"dev\".\"analytics\".\"dim_schools\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.121046Z", "completed_at": "2024-01-21T22:02:07.144351Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.203108Z", "completed_at": "2024-01-21T22:02:07.203120Z"}], "thread_id": "Thread-3", "execution_time": 0.14924931526184082, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.dbt_utils_unique_combination_of_columns_stg_dashboard__school_stats_by_years_school_id__school_year.2ac6586976", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        school_id, school_year\n    from \"dev\".\"analytics\".\"stg_dashboard__school_stats_by_years\"\n    group by school_id, school_year\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.146733Z", "completed_at": "2024-01-21T22:02:07.185604Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.235765Z", "completed_at": "2024-01-21T22:02:07.235776Z"}], "thread_id": "Thread-4", "execution_time": 0.14225125312805176, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.not_null_stg_dashboard__school_stats_by_years_school_id.7dce256f1f", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect school_id\nfrom \"dev\".\"analytics\".\"stg_dashboard__school_stats_by_years\"\nwhere school_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.153878Z", "completed_at": "2024-01-21T22:02:07.188207Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.237887Z", "completed_at": "2024-01-21T22:02:07.237896Z"}], "thread_id": "Thread-5", "execution_time": 0.1381685733795166, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.not_null_stg_dashboard__sections_section_id.7d8448a05a", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect section_id\nfrom \"dev\".\"analytics\".\"stg_dashboard__sections\"\nwhere section_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.160215Z", "completed_at": "2024-01-21T22:02:07.188843Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.238518Z", "completed_at": "2024-01-21T22:02:07.238527Z"}], "thread_id": "Thread-7", "execution_time": 0.13856840133666992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.unique_stg_dashboard__sections_section_id.55d1fb278a", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    section_id as unique_field,\n    count(*) as n_records\n\nfrom \"dev\".\"analytics\".\"stg_dashboard__sections\"\nwhere section_id is not null\ngroup by section_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.164379Z", "completed_at": "2024-01-21T22:02:07.190593Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.240577Z", "completed_at": "2024-01-21T22:02:07.240586Z"}], "thread_id": "Thread-8", "execution_time": 0.13954997062683105, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_user_stages", "compiled": true, "compiled_code": "with\nuser_levels as (\n    select *\n    from \"dev\".\"analytics\".\"stg_dashboard__user_levels\"\n),\n\nlevels_script_levels as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__levels_script_levels\"\n),\n\nscript_levels as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__script_levels\"\n),\n\nstages as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__stages\"\n),\n\nlevels as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__levels\"\n    where type != 'StandaloneVideo'\n    -- excludes problematic levels shared across the multiple stages in the same script, which we can't differentiate\n),\n\ncourse_scripts as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__course_scripts\"\n),\n\nfinal as (\n    select \n        ul.user_id, \n        cs.course_id, \n        sl.script_id, \n        st.stage_id, \n        st.absolute_position      as stage_number, \n        count(*)                  as levels_attempted,\n        min(ul.created_at)::date  as stage_started_at,\n        max(ul.updated_at)        as updated_at\n    from user_levels ul\n    join levels_script_levels lsl on lsl.level_id = ul.level_id\n    join script_levels sl on sl.script_level_id = lsl.script_level_id and sl.script_id = ul.script_id\n    join stages st on st.stage_id = sl.stage_id\n    join levels le on le.level_id = lsl.level_id\n    left join course_scripts cs on cs.script_id = ul.script_id\n    group by 1,2,3,4,5\n)\n\nselect * \nfrom final", "relation_name": "\"dev\".\"analytics\".\"dim_user_stages\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.169150Z", "completed_at": "2024-01-21T22:02:07.191645Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.242594Z", "completed_at": "2024-01-21T22:02:07.242603Z"}], "thread_id": "Thread-9", "execution_time": 0.13593673706054688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.not_null_stg_dashboard__user_levels_user_level_id.1a9bb0d738", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect user_level_id\nfrom \"dev\".\"analytics\".\"stg_dashboard__user_levels\"\nwhere user_level_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.174829Z", "completed_at": "2024-01-21T22:02:07.208437Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.244836Z", "completed_at": "2024-01-21T22:02:07.244845Z"}], "thread_id": "Thread-11", "execution_time": 0.12704086303710938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.unique_stg_dashboard__user_levels_user_level_id.850f4f8bc6", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    user_level_id as unique_field,\n    count(*) as n_records\n\nfrom \"dev\".\"analytics\".\"stg_dashboard__user_levels\"\nwhere user_level_id is not null\ngroup by user_level_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.181225Z", "completed_at": "2024-01-21T22:02:07.215633Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.248835Z", "completed_at": "2024-01-21T22:02:07.248844Z"}], "thread_id": "Thread-10", "execution_time": 0.1280825138092041, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_forms", "compiled": true, "compiled_code": "with \nforms as (\n    select * \n    from \"dev\".\"analytics\".\"stg_pegasus_pii__forms\"\n),\n\nform_geos as (\n    select * \n    from \"dev\".\"analytics\".\"stg_pegasus_pii__form_geos\"\n),\n\ncombined as (\n    select \n        forms.form_id,\n        forms.form_category,\n        forms.hoc_year,\n        forms.email,\n        forms.name,\n        forms.form_kind,\n        forms.updated_at,\n        forms.indexed_at,\n        forms.review,\n        forms.reviewed_by,\n        forms.reviewed_at,\n        forms.processed_at,\n        forms.notified_at,\n        forms.user_id,\n        forms.parent_id,\n        forms.location_country_code,\n        coalesce(forms.city,form_geos.city)                     as city,\n        coalesce(forms.state,form_geos.state)                   as state,\n        coalesce(forms.country,form_geos.country)               as country,\n        max(forms.created_at)                                   as registered_at,\n        max(coalesce(forms.updated_at,forms.created_at))        as last_updated_at\n    from forms \n    left join form_geos \n        on forms.form_id = form_geos.form_id\n    group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19\n)\n\nselect * \nfrom combined", "relation_name": "\"dev\".\"analytics\".\"dim_forms\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.192420Z", "completed_at": "2024-01-21T22:02:07.232240Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.257845Z", "completed_at": "2024-01-21T22:02:07.257855Z"}], "thread_id": "Thread-12", "execution_time": 0.1275348663330078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.redshift.redshift_admin_queries", "compiled": true, "compiled_code": "with  __dbt__cte__stl_query as (\nselect\n\n  userid as user_id\n, query as query_id\n, xid as transaction_id\n, label\n, pid\n, database\n, starttime as started_at\n, endtime as finished_at\n, aborted\n\nfrom pg_catalog.stl_query\n),  __dbt__cte__pg_user as (\nselect\n\n  usesysid as user_id\n, usename as username\n\nfrom pg_catalog.pg_user\n),  __dbt__cte__stl_explain as (\nselect\n\n  userid as user_id\n, query as query_id\n, nodeid\n, parentid\n, plannode\n, info\n\nfrom pg_catalog.stl_explain\n),  __dbt__cte__redshift_cost as (\nwith stl_explain as (\n\n  select query_id, plannode from __dbt__cte__stl_explain\n  where nodeid = 1\n\n), parse_step_one as (\n\n  -- plannode (which contains cost) is formatted like:\n  --   XN Seq Scan on nyc_last_update  (cost=0.00..0.03 rows=2 width=40)\n  -- we want to rip out the cost part (0.00, 0.03) and make it usable.\n  -- cost_string after this step is \"0.00..0.03 ...\"\n  select\n    query_id\n  , split_part(plannode, 'cost=', 2) as cost_string\n\n  from stl_explain\n\n), parse_step_two as (\n\n  select\n    query_id\n  , split_part(cost_string, '..', 1) as starting_cost\n  , substring(\n      split_part(cost_string, '..', 2)\n      from 1\n      for strpos(split_part(cost_string, '..', 2), ' ')) as total_cost\n\n  from parse_step_one\n\n)\n\n\nselect\n\n  query_id\n, starting_cost::float as starting_cost\n, total_cost::float as total_cost\n\nfrom parse_step_two\n),  __dbt__cte__stl_wlm_query as (\nselect\n\n  userid as user_id\n, query as query_id\n, xid\n, task\n, service_class\n, slot_count\n, service_class_start_time\n, queue_start_time\n, queue_end_time\n, total_queue_time\n, exec_start_time\n, exec_end_time\n, total_exec_time\n, service_class_end_time\n, final_state\n\nfrom pg_catalog.stl_wlm_query\n), queries as (\n\n  select * from __dbt__cte__stl_query\n\n), users as (\n\n  select * from __dbt__cte__pg_user\n\n), cost as (\n\n  select * from __dbt__cte__redshift_cost\n\n), timings as (\n\n  select * from __dbt__cte__stl_wlm_query\n\n)\n\n\n\nselect\n\n  queries.query_id\n, queries.transaction_id\n, users.username::varchar\n\n, cost.starting_cost\n, cost.total_cost\n\n, queries.started_at\n, queries.finished_at\n\n, timings.queue_start_time\n, timings.queue_end_time\n, (timings.total_queue_time::float / 1000000.0) as total_queue_time_seconds\n\n, timings.exec_start_time\n, timings.exec_end_time\n, (timings.total_exec_time::float / 1000000.0) as total_exec_time_seconds\n\nfrom queries\n\nleft join users\n  on queries.user_id = users.user_id\n\nleft join cost\n  on queries.query_id = cost.query_id\n\nleft join timings\n  on queries.query_id = timings.query_id", "relation_name": "\"dev\".\"analytics\".\"redshift_admin_queries\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.203889Z", "completed_at": "2024-01-21T22:02:07.233728Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.259727Z", "completed_at": "2024-01-21T22:02:07.259736Z"}], "thread_id": "Thread-13", "execution_time": 0.12739109992980957, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_course_structure", "compiled": true, "compiled_code": "\n\nwith \nscripts as (\n    select *\n    from \"dev\".\"analytics\".\"stg_dashboard__scripts\" \n),\n\nlevels as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__levels\"\n    ),\n\nstages as (\n    select *\n    from \"dev\".\"analytics\".\"stg_dashboard__stages\"\n),\n\nscript_levels as (\n    select *\n    from \"dev\".\"analytics\".\"stg_dashboard__script_levels\"\n),\n\nlevels_script_levels as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__levels_script_levels\"\n),\n\ncourse_scripts as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__course_scripts\"\n),\n\nunit_groups as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__unit_groups\"\n),\n\ncourse_names as (\n    select *\n    from \"dev\".\"analytics\".\"dim_course_names\"\n),\n\nscript_names as (\n    select * \n    from \"dev\".\"analytics\".\"dim_script_names\" \n),\n\ncombined as (\n    select \n        -- courses\n        ug.unit_group_id as course_id,\n        ug.name as course_name,\n        cn.course_name_short,\n        cn.course_name_long,\n        sc.course_name_true,\n\n        -- scripts\n        sl.script_id,\n        sc.script_name,\n        sn.versioned_script_name,\n        sn.script_name_short,\n        sn.script_name_long,\n        \n        -- stages\n        st.stage_id,\n        st.stage_name,\n        st.stage_number,\n\n        -- levels\n        case when sl.script_id = '26' \n              and lsl.level_id = '14633' \n             then 1 else lsl.level_id \n        end as level_id,\n        lev.name as level_name,\n        sl.position as level_number,\n        rank() over(partition by sl.script_id order by st.stage_number, sl.position) as level_script_order,\n        sl.is_assessment,\n        lev.updated_at\n    from levels_script_levels as lsl \n    join script_levels as sl \n        on lsl.script_level_id = sl.script_level_id\n    join levels as lev\n        on lsl.level_id = lev.level_id  \n    join scripts as sc \n        on sl.script_id = sc.script_id\n    join stages as st \n        on sl.stage_id = st.stage_id \n    left join course_scripts as cs \n        on sc.script_id = cs.script_id\n    left join unit_groups as ug \n        on cs.course_id = ug.unit_group_id\n    left join course_names as cn \n        on ug.unit_group_id = cn.versioned_course_id   \n    left join script_names as sn \n        on sc.script_id = sn.versioned_script_id\n)\n\nselect * \nfrom combined", "relation_name": "\"dev\".\"analytics\".\"dim_course_structure\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.208961Z", "completed_at": "2024-01-21T22:02:07.235239Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.261183Z", "completed_at": "2024-01-21T22:02:07.261192Z"}], "thread_id": "Thread-14", "execution_time": 0.13791823387145996, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.not_null_dim_script_names_versioned_script_id.20b063a296", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect versioned_script_id\nfrom \"dev\".\"analytics\".\"dim_script_names\"\nwhere versioned_script_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.216182Z", "completed_at": "2024-01-21T22:02:07.239255Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.265936Z", "completed_at": "2024-01-21T22:02:07.265945Z"}], "thread_id": "Thread-15", "execution_time": 0.17684292793273926, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.unique_dim_script_names_versioned_script_id.139446433d", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    versioned_script_id as unique_field,\n    count(*) as n_records\n\nfrom \"dev\".\"analytics\".\"dim_script_names\"\nwhere versioned_script_id is not null\ngroup by versioned_script_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.223059Z", "completed_at": "2024-01-21T22:02:07.241283Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.267495Z", "completed_at": "2024-01-21T22:02:07.267504Z"}], "thread_id": "Thread-16", "execution_time": 0.16339111328125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.dbt_utils_unique_combination_of_columns_int_school_weeks_school_year__iso_week__school_year_week.26450d8be2", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        school_year, iso_week, school_year_week\n    from \"dev\".\"analytics\".\"int_school_weeks\"\n    group by school_year, iso_week, school_year_week\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.332531Z", "completed_at": "2024-01-21T22:02:07.351192Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.401975Z", "completed_at": "2024-01-21T22:02:07.401988Z"}], "thread_id": "Thread-2", "execution_time": 0.16580867767333984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.int_teacher_schools_historical", "compiled": true, "compiled_code": "\n\nwith \nuser_school_infos as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard_pii__user_school_infos\"\n),\n\nschool_infos as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__school_infos\"\n),\n\nschool_years as (\n    select *\n    from \"dev\".\"analytics\".\"int_school_years\"\n),\n\nuser_school_infos_sy as (\n    select \n        usi.user_id,\n        sy.school_year as started_at_sy,\n        row_number() over (partition by usi.user_id, sy.school_year order by usi.started_at desc) as row_num,\n        usi.school_info_id,\n        si.school_id,\n        usi.started_at,\n        usi.ended_at\n    from user_school_infos usi\n    left join school_infos si \n        on usi.school_info_id = si.school_info_id\n    join school_years sy \n        on usi.started_at between sy.started_at and sy.ended_at\n),\n\nfinal as (\n    select \n        usi_sy.user_id as teacher_id,\n        usi_sy.started_at_sy,\n        usi_sy.started_at, \n        usi_sy.ended_at,\n        usi_sy.school_info_id,\n        usi_sy.school_id\n    from user_school_infos_sy as usi_sy \n    where row_num = 1\n    order by started_at_sy\n)\n\nselect * \nfrom final", "relation_name": "\"dev\".\"analytics\".\"int_teacher_schools_historical\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.337091Z", "completed_at": "2024-01-21T22:02:07.352409Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.403235Z", "completed_at": "2024-01-21T22:02:07.403246Z"}], "thread_id": "Thread-3", "execution_time": 0.16500520706176758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.not_null_dim_levels_level_id.1f8c5dc9a7", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect level_id\nfrom \"dev\".\"analytics\".\"dim_levels\"\nwhere level_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.354873Z", "completed_at": "2024-01-21T22:02:07.393138Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.426997Z", "completed_at": "2024-01-21T22:02:07.427009Z"}], "thread_id": "Thread-4", "execution_time": 0.17824625968933105, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.unique_dim_levels_level_id.5eefad6abc", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    level_id as unique_field,\n    count(*) as n_records\n\nfrom \"dev\".\"analytics\".\"dim_levels\"\nwhere level_id is not null\ngroup by level_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.361433Z", "completed_at": "2024-01-21T22:02:07.395371Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.444553Z", "completed_at": "2024-01-21T22:02:07.444575Z"}], "thread_id": "Thread-5", "execution_time": 0.15311527252197266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.dbt_utils_unique_combination_of_columns_dim_school_stats_by_years_school_year__school_id.572288f478", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        school_year, school_id\n    from \"dev\".\"analytics\".\"dim_school_stats_by_years\"\n    group by school_year, school_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.366489Z", "completed_at": "2024-01-21T22:02:07.395877Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.448165Z", "completed_at": "2024-01-21T22:02:07.448180Z"}], "thread_id": "Thread-7", "execution_time": 0.15363001823425293, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_districts", "compiled": true, "compiled_code": "-- Model: dim_schools\n-- Scope: all dimensions we have/need for schools; one row per school + school_year\nwith\ndim_schools as (\n    select *\n    from \"dev\".\"analytics\".\"dim_schools\"\n),\n\nschool_districts as (\n    select *\n    from \"dev\".\"analytics\".\"stg_dashboard__school_districts\"\n),\n\ncombined as (\n    select\n        school_districts.school_district_id,\n        school_districts.school_district_name,\n        school_districts.school_district_city,\n        school_districts.school_district_state,\n        school_districts.school_district_zip,\n        school_districts.last_known_school_year_open,\n        -- school aggregations\n        count(distinct dim_schools.school_id) as num_schools,\n        sum(dim_schools.is_stage_el) as num_schools_stage_el,\n        sum(dim_schools.is_stage_mi) as num_schools_stage_mi,\n        sum(dim_schools.is_stage_hi) as num_schools_stage_hi,\n        sum(dim_schools.is_rural) as num_schools_rural,\n        sum(dim_schools.is_title_i) as num_schools_title_i,\n        sum(dim_schools.is_high_needs) as num_schools_high_needs,\n        sum(dim_schools.total_students) as num_students,\n        sum(dim_schools.total_frl_eligible_students) as num_students_frl_eligible,\n        sum(total_urg_students) as num_students_urg,\n        \n        -- calculations \n        round(cast(num_students_urg as float) / num_students, 2) :: decimal(10, 4) as district_urg_percent,\n        round(cast(num_students_frl_eligible as float) / num_students, 2) :: decimal(10, 4) as district_frl_eligible_percent\n    from dim_schools\n    left join school_districts\n        on dim_schools.school_district_id = school_districts.school_district_id \n    where dim_schools.school_district_id is not null \n    group by 1,2,3,4,5,6\n)\n\nselect *\nfrom combined", "relation_name": "\"dev\".\"analytics\".\"dim_districts\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.370222Z", "completed_at": "2024-01-21T22:02:07.396628Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.449113Z", "completed_at": "2024-01-21T22:02:07.449125Z"}], "thread_id": "Thread-8", "execution_time": 0.15397310256958008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_school_districts", "compiled": true, "compiled_code": "-- model: dim_school_districts\n-- scope: all dimensions currently available for school districts\n-- author: AG\n-- date: 2024-01-01 \n\nwith\nschools as (\n    select \n        school_district_id,\n        -- aggregations at level of district\n        count(distinct dim_schools.school_id)           as num_schools,\n        sum(dim_schools.is_stage_el)                    as num_schools_stage_el,\n        sum(dim_schools.is_stage_mi)                    as num_schools_stage_mi,\n        sum(dim_schools.is_stage_hi)                    as num_schools_stage_hi,\n        sum(dim_schools.is_rural)                       as num_schools_rural,\n        sum(dim_schools.is_title_i)                     as num_schools_title_i,\n        sum(dim_schools.is_high_needs)                  as num_schools_high_needs,\n        sum(dim_schools.total_students)                 as num_students,\n        sum(dim_schools.total_frl_eligible_students)    as num_students_frl_eligible,\n        sum(total_urg_students)                         as num_students_urg\n    from \"dev\".\"analytics\".\"dim_schools\"\n    where school_district_id is not null\n    group by 1\n),\n\nschool_districts as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__school_districts\"\n    where school_district_id in (select school_district_id from schools)    \n),\n\ncombined as (\n    select \n        -- school district info\n        school_districts.school_district_id,\n        school_districts.school_district_name,\n        school_districts.school_district_city,\n        school_districts.school_district_state,\n        school_districts.school_district_zip,\n        school_districts.last_known_school_year_open,\n        \n        -- school info + aggs\n        schools.num_schools                 as total_schools,-- are these active only?\n        schools.num_schools_stage_el        as total_schools_stage_el,\n        schools.num_schools_stage_mi        as total_schools_stage_mi,\n        schools.num_schools_stage_hi        as total_schools_stage_hi,\n        schools.num_schools_rural           as total_schools_rural,\n        schools.num_schools_title_i         as total_schools_title_i,\n        schools.num_schools_high_needs      as total_schools_high_needs,\n        schools.num_students                as total_students,\n        schools.num_students_frl_eligible   as total_students_frl_eligible,\n        schools.num_students_urg            as total_students_urg,\n        sum(num_students_urg / cast(num_students as float))::decimal(10,2)          as total_district_pct_students_urg,\n        sum(num_students_frl_eligible / cast(num_students as float))::decimal(10,2) as total_district_pct_students_frl_eligible\n    from schools\n    left join school_districts\n        on schools.school_district_id = school_districts.school_district_id\n    group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16\n)\n\nselect * \nfrom combined", "relation_name": "\"dev\".\"analytics\".\"dim_school_districts\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.375283Z", "completed_at": "2024-01-21T22:02:07.401194Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.450020Z", "completed_at": "2024-01-21T22:02:07.450031Z"}], "thread_id": "Thread-9", "execution_time": 0.14966440200805664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.not_null_dim_schools_school_id.baadfc6c97", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect school_id\nfrom \"dev\".\"analytics\".\"dim_schools\"\nwhere school_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.380638Z", "completed_at": "2024-01-21T22:02:07.413257Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.464560Z", "completed_at": "2024-01-21T22:02:07.464575Z"}], "thread_id": "Thread-11", "execution_time": 0.14759469032287598, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.unique_dim_schools_school_id.50ab1b294e", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    school_id as unique_field,\n    count(*) as n_records\n\nfrom \"dev\".\"analytics\".\"dim_schools\"\nwhere school_id is not null\ngroup by school_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.386534Z", "completed_at": "2024-01-21T22:02:07.416548Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.476701Z", "completed_at": "2024-01-21T22:02:07.476716Z"}], "thread_id": "Thread-10", "execution_time": 0.14716196060180664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.dbt_utils_unique_combination_of_columns_dim_user_stages_user_id__course_id__script_id__stage_id.e3e2e91a12", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        user_id, course_id, script_id, stage_id\n    from \"dev\".\"analytics\".\"dim_user_stages\"\n    group by user_id, course_id, script_id, stage_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.397171Z", "completed_at": "2024-01-21T22:02:07.423035Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.487220Z", "completed_at": "2024-01-21T22:02:07.487230Z"}], "thread_id": "Thread-12", "execution_time": 0.1437227725982666, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.not_null_dim_forms_form_id.51d004ca2c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect form_id\nfrom \"dev\".\"analytics\".\"dim_forms\"\nwhere form_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.404065Z", "completed_at": "2024-01-21T22:02:07.424310Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.488327Z", "completed_at": "2024-01-21T22:02:07.488337Z"}], "thread_id": "Thread-13", "execution_time": 0.14206552505493164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.unique_dim_forms_form_id.3c980f09d6", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    form_id as unique_field,\n    count(*) as n_records\n\nfrom \"dev\".\"analytics\".\"dim_forms\"\nwhere form_id is not null\ngroup by form_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.408558Z", "completed_at": "2024-01-21T22:02:07.426395Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.490904Z", "completed_at": "2024-01-21T22:02:07.490914Z"}], "thread_id": "Thread-14", "execution_time": 0.14271140098571777, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_student_courses", "compiled": true, "compiled_code": "/* \nUpdated 12/6/23:\n\n1. Design:\n    student_id int,\n    school_year varchar(10),\n    course_name varchar(3),\n    last_activity_at timestamp\n\n2. Definitions:\n    - a student is included in this table if they attempted a level of a given course within a given SY\n    - this table is used to determine \"active\" students within a section and assigning a \"section_status\"\n\n3. Sources:\n    dim_user_levels\n    course_structure\n    school_years\n\nRef: dataops-316\n*/\n\nwith \nuser_levels as (\n    select \n        user_id,\n        level_id,\n        script_id,\n        created_at\n    from \"dev\".\"analytics\".\"stg_dashboard__user_levels\"\n),\n\ncourse_structure as (\n    select  \n        course_name_true, \n        level_id, \n        script_id \n    from \"dev\".\"analytics\".\"dim_course_structure\"\n),\n\nschool_years as (\n    select *\n    from \"dev\".\"analytics\".\"int_school_years\"\n),\n\ncombined as (\n    select \n         ul.user_id             as student_id\n\t\t,sy.school_year\n\t\t,cs.course_name_true    as course_name\n        ,min(ul.created_at)     as first_activity_at \n\t\t,max(ul.created_at)     as last_activity_at\n\tfrom user_levels ul \n\tjoin course_structure cs\n\t\ton ul.script_id = cs.script_id \n        and ul.level_id = cs.level_id \n\tjoin school_years sy \n\t\ton ul.created_at \n            between sy.started_at and sy.ended_at\n    group by 1,2,3\n)\n\nselect *\nfrom combined", "relation_name": "\"dev\".\"analytics\".\"dim_student_courses\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.273359Z", "completed_at": "2024-01-21T22:02:07.756682Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.758020Z", "completed_at": "2024-01-21T22:02:07.758030Z"}], "thread_id": "Thread-1", "execution_time": 0.5423095226287842, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_students", "compiled": true, "compiled_code": "with \nstudents as (\n    select \n    \"student_id\",\n  \"user_type\",\n  \"gender\",\n  \"is_urg\",\n  \"locale\",\n  \"sign_in_count\",\n  \"total_lines\",\n  \"current_sign_in_at\",\n  \"last_sign_in_at\",\n  \"created_at\",\n  \"updated_at\",\n  \"deleted_at\",\n  \"purged_at\"\n    from \"dev\".\"analytics\".\"stg_dashboard__users\"\n    where student_id is not null \n),\n\nuser_geos as (\n    select \n        user_id, \n        is_international\n    from \"dev\".\"analytics\".\"stg_dashboard__user_geos\"\n    where user_id in (select student_id from students)\n),\n\nschool_years as (\n    select * from \"dev\".\"analytics\".\"int_school_years\"\n),\n\nfinal as (\nselect \n    students.*, \n    user_geos.is_international,\n    sy.school_year created_at_school_year\nfrom students \njoin user_geos \n    on students.student_id = user_geos.user_id\nleft join school_years sy on students.created_at between sy.started_at and sy.ended_at\n)\n\nselect * \nfrom final", "relation_name": "\"dev\".\"analytics\".\"dim_students\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.311761Z", "completed_at": "2024-01-21T22:02:07.758487Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.760757Z", "completed_at": "2024-01-21T22:02:07.760764Z"}], "thread_id": "Thread-6", "execution_time": 0.5411474704742432, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_teachers", "compiled": true, "compiled_code": "with \nteachers as (\n    select \n    \"teacher_id\",\n  \"studio_person_id\",\n  \"user_type\",\n  \"age_years\",\n  \"gender\",\n  \"locale\",\n  \"sign_in_count\",\n  \"school_info_id\",\n  \"total_lines\",\n  \"current_sign_in_at\",\n  \"last_sign_in_at\",\n  \"created_at\",\n  \"updated_at\",\n  \"deleted_at\",\n  \"purged_at\"\n    from \"dev\".\"analytics\".\"stg_dashboard__users\"\n    where teacher_id is not null \n),\n\nuser_geos as (\n    select \n        user_id, \n        is_international\n    from \"dev\".\"analytics\".\"stg_dashboard__user_geos\"\n    where user_id in (select teacher_id from teachers)\n),\n\nuser_school_infos as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard_pii__user_school_infos\"\n),\n\nschool_infos as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__school_infos\"\n), \n\nschool_years as (\n    select * \n    from \"dev\".\"analytics\".\"int_school_years\"\n),\n\n-- get teacher NCES school_id association\nteacher_schools as (\n    select \n        teachers.teacher_id,\n        si.school_id,\n        rank () over (partition by teachers.teacher_id order by si.school_id, usi.ended_at desc) rnk\n    from teachers\n    left join user_school_infos as usi    \n        on usi.user_id = teachers.teacher_id\n    left join school_infos as si \n        on si.school_info_id = usi.school_info_id\n    where si.school_id is not null\n),\n\nteacher_latest_school as (\n    select \n        teacher_id,\n        school_id\n    from teacher_schools\n    where rnk = 1\n)\n\nselect \n    teachers.*, \n    school_years.school_year as created_at_school_year,\n    tls.school_id,\n    user_geos.is_international\nfrom teachers \njoin user_geos \n    on teachers.teacher_id = user_geos.user_id\nleft join teacher_latest_school tls \n    on tls.teacher_id = user_geos.user_id\nleft join school_years \n    on teachers.created_at between school_years.started_at and school_years.ended_at", "relation_name": "\"dev\".\"analytics\".\"dim_teachers\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.801544Z", "completed_at": "2024-01-21T22:02:07.821802Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.848977Z", "completed_at": "2024-01-21T22:02:07.848991Z"}], "thread_id": "Thread-15", "execution_time": 0.06019306182861328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.int_user_levels", "compiled": true, "compiled_code": "-- int_user_levels\n\nwith \nuser_levels as (\n    select * \n    from \"dev\".\"analytics\".\"stg_dashboard__user_levels\"\n),\n\nstudents as (\n    select * \n    from \"dev\".\"analytics\".\"dim_students\"\n    where student_id in (select user_id from user_levels)\n),\n\nfinal as (\n    select \n        distinct user_levels.user_id,\n        students.is_international,\n        user_levels.level_id,\n        user_levels.script_id\n    from user_levels \n    join students \n        on user_levels.user_id = students.student_id \n)\n\nselect * \nfrom final", "relation_name": "\"dev\".\"analytics\".\"int_user_levels\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.810367Z", "completed_at": "2024-01-21T22:02:07.833666Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.851765Z", "completed_at": "2024-01-21T22:02:07.851778Z"}], "thread_id": "Thread-16", "execution_time": 0.06350064277648926, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.not_null_dim_students_student_id.10ef5e35c7", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect student_id\nfrom \"dev\".\"analytics\".\"dim_students\"\nwhere student_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.815304Z", "completed_at": "2024-01-21T22:02:07.834922Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.857184Z", "completed_at": "2024-01-21T22:02:07.857193Z"}], "thread_id": "Thread-6", "execution_time": 0.06837272644042969, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.unique_dim_students_student_id.02754676d0", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    student_id as unique_field,\n    count(*) as n_records\n\nfrom \"dev\".\"analytics\".\"dim_students\"\nwhere student_id is not null\ngroup by student_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.824139Z", "completed_at": "2024-01-21T22:02:07.848423Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.859992Z", "completed_at": "2024-01-21T22:02:07.860002Z"}], "thread_id": "Thread-2", "execution_time": 0.06650185585021973, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_student_status", "compiled": true, "compiled_code": "/*\n\nDesign: 1 row per student, school_year, churn_status\nLogic: we can determine status based on three properties we can compute for every user|school_year as a binary:\n    - 0/1 they are active this school_year - (A)ctive\n    - 0/1 they were active in the previous school_year - (P)rev year\n    - 0/1 they have ever been active in ANY school_year prior, incl. prev year - (E)ver before\n\n    Rather than write out long complicated combinational logic in code, these 3 values can be combined \n    into an ordered 3-char string representing the concatenated true/false combinations for Active|Prev|Ever \n    e.g. \"101\" means: ( Active = true AND Prev year = false AND Ever before = true )\n    To practice some defensive programming, we'll handle all cases exhaustively and return a \n    sentinal '<impossible status>' value as a fast-fail value for cases that we believe to be impossible.\n\n    - '000' (0) = 'market'              -- Not active now + never been active\n    - '001' (1) = 'inactive churn'      -- NOT active + NOT active prev year + active ever before\n    - '010' (2) = '<impossible status>' -- should not be possible, active in the prev year should imply active ever before\n    - '011' (3) = 'inactive this year'  -- NOT active + active prev year + (active ever before implied)\n    - '100' (4) = 'active new'          -- active this year + NOT active last year + NOT active ever before\n    - '101' (5) = 'active reacquired'   -- Active this year + NOT active last year + active in the past\n    - '110' (6) = '<impossible status>' -- impossible for same reason as status (2)\n    - '111' (7) = 'active retained'     -- active this year + active last year + (active ever before implied)\n\n*/\n\nwith \n\nstudent_courses_started as (\n\n    select\n        student_id,\n        school_year,\n        listagg(distinct course_name, ', ') within group (order by course_name ASC) courses_started\n    from \"dev\".\"analytics\".\"dim_student_courses\"\n    group by 1, 2\n\n),\n\nall_student_users as (\n\n    select\n        student_id,\n        created_at\n    from \"dev\".\"analytics\".\"dim_students\"\n\n), \n\nschool_years as (\n\n    select * from \"dev\".\"analytics\".\"int_school_years\"\n\n), \n\nall_students_school_years as (\n\n    select\n        u.student_id,\n        sy.school_year\n    from all_student_users u\n    join school_years sy on u.created_at <= sy.ended_at\n    where sy.started_at < current_timestamp\n\n), \n\nactive_status_simple as (\n\n    select\n        all_sy.student_id,\n        all_sy.school_year,\n        case when s.student_id is null then 0 else 1 end as is_active,\n        s.courses_started\n\n    from all_students_school_years all_sy\n    left join student_courses_started s on s.student_id = all_sy.student_id and s.school_year = all_sy.school_year\n\n), \n\nfull_status as (\n    -- Determine the active status for each student in each year\n\n    select\n        student_id,\n        school_year,\n        is_active,\n        courses_started,\n        coalesce(\n            lag(is_active, 1) \n                over (partition by student_id order by school_year) \n            , 0\n        ) as prev_year_active,\n        coalesce( --force any NULL to be 0 for this function\n            max(is_active) \n                over (partition by student_id order by school_year rows between unbounded preceding and 1 preceding)\n            , 0\n        ) as ever_active_before,\n        (is_active || prev_year_active || ever_active_before) status_code\n    from\n        active_status_simple\n\n), \n\ncurrent_school_year as (\n\n    select \n        school_year\n    from \"dev\".\"analytics\".\"int_school_years\"\n    where current_date between started_at and ended_at\n\n)\n\nselect\n    student_id,\n    school_year,\n    --is_active,\n    --prev_year_active,\n    --ever_active_before,\n    --status_code,\n    case \n        when status_code = '000' then 'market'\n        when status_code = '001' then 'inactive churn'\n        when status_code = '010' then '<impossible status>'\n        when status_code = '011' then 'inactive this year'\n        when status_code = '100' then 'active new'\n        when status_code = '101' then 'active reacquired'\n        when status_code = '110' then '<impossible status>'\n        when status_code = '111' then 'active retained'\n    end as status,\n    courses_started\nfrom\n    full_status\norder by\n    student_id, school_year", "relation_name": "\"dev\".\"analytics\".\"dim_student_status\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.828541Z", "completed_at": "2024-01-21T22:02:07.849693Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.863353Z", "completed_at": "2024-01-21T22:02:07.863368Z"}], "thread_id": "Thread-4", "execution_time": 0.06385040283203125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.int_section_mapping", "compiled": true, "compiled_code": "/* \n1. Design:\n    school_year\n    student_id\n    teacher_id\n    section_id\n\n2. Definitions:\n    this table provides mapping across these foreign keys, \n    serving as an intermediary (xref) model\n\n3. Sources:\n\nRef: DATAOPS-321 */\n\nwith \nschool_years as (\n    select *\n    from \"dev\".\"analytics\".\"int_school_years\"\n),\n\nfollowers as (\n    select *\n    from \"dev\".\"analytics\".\"stg_dashboard__followers\"\n),\n\nteachers as (\n    select distinct \n        teacher_id,\n        school_id\n    from \"dev\".\"analytics\".\"dim_teachers\"\n),\n\nsections as (\n    select distinct \n        user_id,\n        section_id\n    from \"dev\".\"analytics\".\"stg_dashboard__sections\"\n),\n\ncombined as (\n    select \n        sy.school_year, \n        followers.student_id,\n        sections.user_id            as teacher_id,\n        sections.section_id         as section_id,\n        teachers.school_id,\n        row_number() over(\n            partition by \n                followers.student_id, \n                sy.school_year\n                order by \n                    followers.created_at\n        ) as row_num\n\n    from followers  \n    left join sections \n        on followers.section_id = sections.section_id\n    left join teachers \n        on sections.user_id = teachers.teacher_id\n    join school_years as sy \n        on followers.created_at \n            between sy.started_at and sy.ended_at\n),\n\nfinal as (\n    select \n        student_id,\n        school_year,\n        section_id,\n        teacher_id,\n        school_id\n    from combined\n    where row_num = 1\n)\n\nselect * \nfrom final", "relation_name": "\"dev\".\"analytics\".\"int_section_mapping\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.842826Z", "completed_at": "2024-01-21T22:02:07.854562Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.866856Z", "completed_at": "2024-01-21T22:02:07.866865Z"}], "thread_id": "Thread-7", "execution_time": 0.06286764144897461, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.unique_dim_teachers_teacher_id.55db8b21ab", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    teacher_id as unique_field,\n    count(*) as n_records\n\nfrom \"dev\".\"analytics\".\"dim_teachers\"\nwhere teacher_id is not null\ngroup by teacher_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.835939Z", "completed_at": "2024-01-21T22:02:07.855408Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.868438Z", "completed_at": "2024-01-21T22:02:07.868450Z"}], "thread_id": "Thread-5", "execution_time": 0.06618094444274902, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.not_null_dim_teachers_teacher_id.c414c8c807", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect teacher_id\nfrom \"dev\".\"analytics\".\"dim_teachers\"\nwhere teacher_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.875976Z", "completed_at": "2024-01-21T22:02:07.888769Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.897481Z", "completed_at": "2024-01-21T22:02:07.897494Z"}], "thread_id": "Thread-9", "execution_time": 0.03246331214904785, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.dbt_utils_unique_combination_of_columns_int_user_levels_user_id__level_id__script_id.b41082019b", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        user_id, level_id, script_id\n    from \"dev\".\"analytics\".\"int_user_levels\"\n    group by user_id, level_id, script_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.885494Z", "completed_at": "2024-01-21T22:02:07.896827Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.901974Z", "completed_at": "2024-01-21T22:02:07.901988Z"}], "thread_id": "Thread-10", "execution_time": 0.02190709114074707, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.int_active_sections", "compiled": true, "compiled_code": "\n\nwith\nstudent_section as (\n    select *\n    from \"dev\".\"analytics\".\"int_section_mapping\"\n),\n\nstudent_course_starts as (\n    select *\n    from \"dev\".\"analytics\".\"dim_student_courses\"\n    where student_id in (select student_id from student_section)\n),\n\ncombined as (\n    select \n         ss.teacher_id\n\t\t,ss.school_year\n\t\t,scs.course_name\n\t\t,ss.section_id\n        ,min(scs.first_activity_at) as section_started_at\n\t\t,count(distinct ss.student_id) as num_students \n\tfrom student_course_starts scs\n\tjoin student_section ss \n\ton scs.student_id = ss.student_id \n    and scs.school_year = ss.school_year \n\tgroup by 1,2,3,4\n),\n\nfinal as (\n    select \n         teacher_id\n        ,school_year\n        ,course_name\n        ,section_id\n        ,section_started_at\n        ,num_students\n    from combined\n    where num_students >= 5\n)\n\nselect *\nfrom final", "relation_name": "\"dev\".\"analytics\".\"int_active_sections\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.889871Z", "completed_at": "2024-01-21T22:02:07.898329Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.903202Z", "completed_at": "2024-01-21T22:02:07.903212Z"}], "thread_id": "Thread-12", "execution_time": 0.02196192741394043, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.dbt_utils_unique_combination_of_columns_int_section_mapping_student_id__school_year__section_id__teacher_id__school_id.1fd3b5f84d", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        student_id, school_year, section_id, teacher_id, school_id\n    from \"dev\".\"analytics\".\"int_section_mapping\"\n    group by student_id, school_year, section_id, teacher_id, school_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.916478Z", "completed_at": "2024-01-21T22:02:07.939199Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.945229Z", "completed_at": "2024-01-21T22:02:07.945247Z"}], "thread_id": "Thread-14", "execution_time": 0.039144039154052734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_district_status", "compiled": true, "compiled_code": "\n\nwith \n\ndim_schools as (\n    select * \n    from \"dev\".\"analytics\".\"dim_schools\"\n),\n\nall_districts as (\n    select school_district_id\n    from \"dev\".\"analytics\".\"dim_districts\"\n),\n\nschool_years as (\n    select * \n    from \"dev\".\"analytics\".\"int_school_years\"\n),\n\nall_districts_sy as (\n    select \n        all_districts.school_district_id,\n        school_years.school_year\n    from all_districts \n    cross join school_years\n),\n\nteacher_school_changes as (\n    select *\n    from \"dev\".\"analytics\".\"int_teacher_schools_historical\"\n),\n\nteacher_active_courses as (\n    select \n        distinct teacher_id,\n        school_year,\n        course_name,\n        section_started_at\n    from \"dev\".\"analytics\".\"int_active_sections\"\n),\n\nteacher_active_courses_with_sy as (\n\n    select\n        tac.teacher_id,\n        tac.school_year,\n        tac.course_name,\n        tac.section_started_at,\n        tsc.school_id,\n        dim_schools.school_district_id\n    from teacher_active_courses tac \n    join school_years sy\n        on tac.school_year = sy.school_year\n    join teacher_school_changes tsc \n        on tac.teacher_id = tsc.teacher_id \n        and sy.ended_at between tsc.started_at and tsc.ended_at \n    join dim_schools \n        on tsc.school_id = dim_schools.school_id\n),\n\nstarted_districts as (\n    select \n        school_district_id,\n        school_year,\n        min(section_started_at) as district_started_at,\n        listagg( distinct course_name, ', ') within group (order by course_name) active_courses\n    from teacher_active_courses_with_sy\n    group by 1, 2\n),\n\nactive_status_simple as (\n    select \n        all_districts_sy.school_district_id,\n        all_districts_sy.school_year,\n        case when started_districts.school_district_id is null then 0 else 1 end as is_active,\n        started_districts.district_started_at,\n        started_districts.active_courses\n    from all_districts_sy \n    left join started_districts\n        on started_districts.school_district_id = all_districts_sy.school_district_id \n        and started_districts.school_year = all_districts_sy.school_year\n),\n\nfull_status as (\n    -- Determine the active status for each school in each school year\n\n    select\n        school_district_id,\n        school_year,\n        is_active,\n        coalesce(\n            lag(is_active, 1) \n                over (partition by school_district_id order by school_year) \n            , 0\n        ) as prev_year_active,\n        coalesce( --force any NULL to be 0 for this function\n            max(is_active) \n                over (partition by school_district_id order by school_year rows between unbounded preceding and 1 preceding)\n            , 0\n        ) as ever_active_before,\n        (is_active || prev_year_active || ever_active_before) status_code,\n        district_started_at,\n        active_courses\n    from\n        active_status_simple\n\n), \n\nfinal as (\n\n    select\n        school_district_id,\n        school_year,\n        case \n            when status_code = '000' then 'market'\n            when status_code = '001' then 'inactive churn'\n            when status_code = '010' then '<impossible status>'\n            when status_code = '011' then 'inactive this year'\n            when status_code = '100' then 'active new'\n            when status_code = '101' then 'active reacquired'\n            when status_code = '110' then '<impossible status>'\n            when status_code = '111' then 'active retained'\n        end as status,\n        district_started_at,\n        active_courses\n        from full_status\n    order by\n        school_district_id, school_year\n)\n\nselect * \nfrom final", "relation_name": "\"dev\".\"analytics\".\"dim_district_status\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.929904Z", "completed_at": "2024-01-21T22:02:07.940547Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.946913Z", "completed_at": "2024-01-21T22:02:07.946924Z"}], "thread_id": "Thread-3", "execution_time": 0.039145469665527344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_teacher_status", "compiled": true, "compiled_code": "\n\nwith \nteacher_section_started as (\n    select teacher_id,\n        school_year,\n        min(section_started_at) as started_teaching_at,\n        listagg(distinct course_name, ', ') within group (order by course_name ASC) section_courses_started\n    from \"dev\".\"analytics\".\"int_active_sections\"\n    where teacher_id is not null \n    group by 1, 2\n),\n\nall_teacher_users as (\n\n    select\n        teacher_id,\n        created_at\n    from \"dev\".\"analytics\".\"dim_teachers\"\n\n), \n\nschool_years as (\n    select *\n    from \"dev\".\"analytics\".\"int_school_years\"\n),\n\nall_teachers_school_years as (\n\n    select\n        u.teacher_id,\n        sy.school_year\n    from all_teacher_users u\n    join school_years sy on u.created_at <= sy.ended_at\n    where sy.started_at < current_timestamp\n\n), \n\nactive_status_simple as (\n\n    select\n        all_sy.teacher_id,\n        all_sy.school_year,\n        case when t.teacher_id is null then 0 else 1 end as is_active,\n        t.section_courses_started,\n        t.started_teaching_at\n\n    from all_teachers_school_years all_sy\n    left join teacher_section_started t on t.teacher_id = all_sy.teacher_id and t.school_year = all_sy.school_year\n\n), \n\nfull_status as (\n    -- Determine the active status for each teacher in each year\n\n    select\n        teacher_id,\n        school_year,\n        is_active,\n        section_courses_started,\n        started_teaching_at,\n        coalesce(\n            lag(is_active, 1) \n                over (partition by teacher_id order by school_year) \n            , 0\n        ) as prev_year_active,\n        coalesce( --force any NULL to be 0 for this function\n            max(is_active) \n                over (partition by teacher_id order by school_year rows between unbounded preceding and 1 preceding)\n            , 0\n        ) as ever_active_before,\n        (is_active || prev_year_active || ever_active_before) status_code\n    from\n        active_status_simple\n\n), \n\nfinal as (\n\n    select\n        teacher_id,\n        school_year,\n        case \n            when status_code = '000' then 'market'\n            when status_code = '001' then 'inactive churn'\n            when status_code = '010' then '<impossible status>'\n            when status_code = '011' then 'inactive this year'\n            when status_code = '100' then 'active new'\n            when status_code = '101' then 'active reacquired'\n            when status_code = '110' then '<impossible status>'\n            when status_code = '111' then 'active retained'\n        end as status,\n        section_courses_started,\n        started_teaching_at\n    from\n        full_status\n    order by\n        teacher_id, school_year\n)\n\nselect * \nfrom final", "relation_name": "\"dev\".\"analytics\".\"dim_teacher_status\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.925409Z", "completed_at": "2024-01-21T22:02:07.941065Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.947655Z", "completed_at": "2024-01-21T22:02:07.947665Z"}], "thread_id": "Thread-1", "execution_time": 0.04127907752990723, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.dim_school_status", "compiled": true, "compiled_code": "\n\nwith \n\nall_schools as (\n    select school_id\n    from \"dev\".\"analytics\".\"dim_schools\"\n),\n\nschool_years as (\n    select * \n    from \"dev\".\"analytics\".\"int_school_years\"\n),\n\nall_schools_sy as (\n    select \n        all_schools.school_id,\n        school_years.school_year\n    from all_schools \n    cross join school_years\n),\n\nteacher_school_changes as (\n    select *\n    from \"dev\".\"analytics\".\"int_teacher_schools_historical\"\n),\n\nteacher_active_courses as (\n    select \n        distinct teacher_id,\n        school_year,\n        course_name,\n        section_started_at\n    from \"dev\".\"analytics\".\"int_active_sections\"\n),\n\nteacher_active_courses_with_sy as (\n\n    select\n        tac.teacher_id,\n        tac.school_year,\n        tac.course_name,\n        tac.section_started_at,\n        tsc.school_id\n    from teacher_active_courses tac \n    join school_years sy\n        on tac.school_year = sy.school_year\n    join teacher_school_changes tsc \n        on tac.teacher_id = tsc.teacher_id \n        and sy.ended_at between tsc.started_at and tsc.ended_at \n),\n\nstarted_schools as (\n    select \n        school_id,\n        school_year,\n        min(section_started_at) as school_started_at,\n        listagg( distinct course_name, ', ') within group (order by course_name) active_courses\n    from teacher_active_courses_with_sy\n    group by 1, 2\n),\n\nactive_status_simple as (\n    select \n        all_schools_sy.school_id,\n        all_schools_sy.school_year,\n        case when started_schools.school_id is null then 0 else 1 end as is_active,\n        started_schools.school_started_at,\n        started_schools.active_courses\n    from all_schools_sy \n    left join started_schools\n        on started_schools.school_id = all_schools_sy.school_id \n        and started_schools.school_year = all_schools_sy.school_year\n),\n\nfull_status as (\n    -- Determine the active status for each school in each school year\n\n    select\n        school_id,\n        school_year,\n        is_active,\n        coalesce(\n            lag(is_active, 1) \n                over (partition by school_id order by school_year) \n            , 0\n        ) as prev_year_active,\n        coalesce( --force any NULL to be 0 for this function\n            max(is_active) \n                over (partition by school_id order by school_year rows between unbounded preceding and 1 preceding)\n            , 0\n        ) as ever_active_before,\n        (is_active || prev_year_active || ever_active_before) status_code,\n        school_started_at,\n        active_courses\n    from\n        active_status_simple\n\n), \n\nfinal as (\n\n    select\n        school_id,\n        school_year,\n        case \n            when status_code = '000' then 'market'\n            when status_code = '001' then 'inactive churn'\n            when status_code = '010' then '<impossible status>'\n            when status_code = '011' then 'inactive this year'\n            when status_code = '100' then 'active new'\n            when status_code = '101' then 'active reacquired'\n            when status_code = '110' then '<impossible status>'\n            when status_code = '111' then 'active retained'\n        end as status,\n        school_started_at,\n        active_courses\n        from full_status\n    order by\n        school_id, school_year\n)\n\nselect * \nfrom final", "relation_name": "\"dev\".\"analytics\".\"dim_school_status\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.933684Z", "completed_at": "2024-01-21T22:02:07.942793Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.950238Z", "completed_at": "2024-01-21T22:02:07.950247Z"}], "thread_id": "Thread-8", "execution_time": 0.0408632755279541, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.dbt_utils_unique_combination_of_columns_int_active_sections_teacher_id__school_year__course_name__section_id.df94559703", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        teacher_id, school_year, course_name, section_id\n    from \"dev\".\"analytics\".\"int_active_sections\"\n    group by teacher_id, school_year, course_name, section_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.960276Z", "completed_at": "2024-01-21T22:02:07.972172Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.973599Z", "completed_at": "2024-01-21T22:02:07.973613Z"}], "thread_id": "Thread-8", "execution_time": 0.01815009117126465, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.cdo_analytics.dbt_utils_unique_combination_of_columns_dim_teacher_status_school_year__teacher_id.b0cc028c6b", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        school_year, teacher_id\n    from \"dev\".\"analytics\".\"dim_teacher_status\"\n    group by school_year, teacher_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-21T22:02:07.965560Z", "completed_at": "2024-01-21T22:02:07.975474Z"}, {"name": "execute", "started_at": "2024-01-21T22:02:07.977633Z", "completed_at": "2024-01-21T22:02:07.977644Z"}], "thread_id": "Thread-11", "execution_time": 0.021510839462280273, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.cdo_analytics.fct_weekly_school_acquisition_metrics", "compiled": true, "compiled_code": "with \nschool_status as (\n    select * \n    from \"dev\".\"analytics\".\"dim_school_status\"\n),\n\ndim_schools as (\n    select * \n    from \"dev\".\"analytics\".\"dim_schools\"\n),\n\nschool_status_sy as (\n    select \n        school_status.school_id,\n        school_status.school_year,\n        school_status.status,\n        school_status.active_courses,\n        dim_schools.school_level_simple,\n        dim_schools.is_stage_el,\n        dim_schools.is_stage_mi,\n        dim_schools.is_stage_hi,\n        school_status.school_started_at\n    from school_status \n    left join dim_schools \n        on school_status.school_id = dim_schools.school_id\n)\n, school_weeks as (\n    select * FROM \"dev\".\"analytics\".\"int_school_weeks\"\n)\n\n, active_schools_by_week as (\n    select \n        sssy.school_year,\n        sssy.school_level_simple,\n        sssy.is_stage_el,\n        sssy.is_stage_mi,\n        sssy.is_stage_hi,\n        sssy.status,\n        sw.iso_week start_week, --keeping start_week alias for now, even though the output gets re-aliased as iso_week\n        sw.school_year_week,\n        sw.started_at week_of,\n        count(distinct school_id) as num_schools\n    from school_status_sy sssy\n    left join school_weeks sw\n        on school_started_at between sw.started_at and sw.ended_at\n    where status like 'active %'\n    group by 1,2,3,4,5,6,7,8,9\n\n)\n, running_totals_by_week as (\n    select\n        school_year,\n        status,\n        start_week,\n        school_year_week,\n        min(week_of)::date week_of,\n        sum(case when is_stage_el=1 then num_schools else 0 end) as el_schools,\n        sum(case when is_stage_mi=1 then num_schools else 0 end) as mi_schools,\n        sum(case when is_stage_hi=1 then num_schools else 0 end) as hi_schools,\n        sum(el_schools) over (\n            partition by school_year, status order by school_year_week\n            rows between unbounded preceding and current row\n        ) el_running_total,\n        \n        sum(mi_schools) over (\n            partition by school_year, status order by school_year_week\n            rows between unbounded preceding and current row\n        ) mi_running_total,\n        \n        sum(hi_schools) over (\n            partition by school_year, status order by school_year_week\n            rows between unbounded preceding and current row\n        ) hi_running_total\n    from active_schools_by_week\n    group by 1,2,3,4\n    order by status, school_year_week\n),\n\nreport_by_week as (\n    select\n        'elementary'                as school_level,\n        school_year,\n        status,\n        start_week                  as iso_week,\n        school_year_week,\n        week_of,\n        el_schools                  as num_schools_this_week,\n        el_running_total            as num_schools_running_total\n    \n    from running_totals_by_week\n\n  \n    union all\n  \n    select\n        'middle'                    as school_level,\n        school_year,\n        status,\n        start_week                  as iso_week,\n        school_year_week,\n        week_of,\n        mi_schools                  as num_schools_this_week,\n        mi_running_total            as num_schools_running_total\n    from running_totals_by_week\n\n    union all\n  \n    select\n        'high'                      as school_level,\n        school_year,\n        status,\n        start_week                  as iso_week,\n        school_year_week,\n        week_of,\n        hi_schools                  as num_schools_this_week,\n        hi_running_total            as num_schools_running_total\n    from running_totals_by_week\n)\n\nselect * \nfrom report_by_week", "relation_name": "\"dev\".\"analytics\".\"fct_weekly_school_acquisition_metrics\""}], "elapsed_time": 2.810330390930176, "args": {"log_level": "info", "state": "/tmp/defer-artifacts", "log_path": "/tmp/jobs/243232111/target/dbt/logs", "debug": true, "vars": {}, "target": "default", "defer": true, "printer_width": 80, "profiles_dir": "/tmp/jobs/243232111/.dbt", "quiet": false, "exclude": [], "send_anonymous_usage_stats": true, "invocation_command": "dbt --log-format json --debug docs generate --target default --profile user --profiles-dir /tmp/jobs/243232111/.dbt --project-dir /tmp/jobs/243232111/target/dbt", "use_colors_file": true, "write_json": true, "print": true, "log_format_file": "json", "project_dir": "/tmp/jobs/243232111/target/dbt", "warn_error_options": {"include": [], "exclude": []}, "show_resource_report": false, "partial_parse": true, "partial_parse_file_diff": true, "log_file_max_bytes": 10485760, "cache_selected_only": false, "indirect_selection": "eager", "which": "generate", "use_colors": true, "select": [], "introspect": true, "macro_debugging": false, "version_check": true, "strict_mode": false, "populate_cache": true, "compile": true, "static_parser": true, "favor_state": false, "enable_legacy_logger": false, "static": false, "profile": "user", "log_format": "json", "empty_catalog": false, "log_level_file": "debug"}}